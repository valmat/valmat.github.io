<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en">
    <generator uri="https://gohugo.io/" version="0.152.1">Hugo</generator>
    <title>Archive on Valmat&#39;s Personal Blog</title>
            <link href="https://valmat.ru/tags/archive/" rel="alternate" type="text/html" title="html" />
            <link href="https://valmat.ru/tags/archive/feed.xml" rel="self" type="application/atom+xml" title="atom" />
    <updated>2025-10-23T01:37:11+03:00</updated>
    <id>https://valmat.ru/tags/archive/</id>
        <entry>
            <title>Haskell</title>
            <link href="https://valmat.ru/posts/archive/2016/11/haskell/" rel="alternate" type="text/html"  hreflang="en" />
            <id>https://valmat.ru/posts/archive/2016/11/haskell/</id>
            <published>2016-11-14T12:49:58+03:00</published>
            <updated>2016-11-14T12:49:58+03:00</updated>
            <content type="html">
                &lt;p&gt;Мои эксперементы с Haskell&lt;/p&gt;
&lt;p&gt;Сделал тоже самое что описано в &lt;a
  class=&#34;gblog-markdown__link&#34;
  href=&#34;/posts/archive/2014/11/cpp-tolist/&#34;
&gt;посте про C++&lt;/a&gt;&lt;/p&gt;
&lt;script src=&#34;https://gist.github.com/valmat/dfde28138a143f4e339eb79233a887ea.js&#34;&gt;&lt;/script&gt;

&lt;p&gt;Haskell &amp;ndash; классный язык программирования. Но писатьна нём что то в одиночку очень тяжело.&lt;/p&gt;

            </content>    
                                <category scheme="https://valmat.ru/tags/archive" term="archive" label="archive" />
        </entry>
        <entry>
            <title>Мой первый Arduino проект</title>
            <link href="https://valmat.ru/posts/archive/2016/02/battery-sensor/" rel="alternate" type="text/html"  hreflang="en" />
            <id>https://valmat.ru/posts/archive/2016/02/battery-sensor/</id>
            <published>2016-02-21T15:35:00+00:00</published>
            <updated>2016-02-21T15:35:00+00:00</updated>
            <content type="html">
                &lt;p&gt;Пару лет назад подарили отцу на день рождения лодочный электромотор и литиевый тяговый аккумулятор к нему. Хорошая вещь, сплошные положительные эмоции от использования. Но, как оказалось, мотор не рассчитан на работу с этим аккумулятором. В том смысле, что индикация уровня заряда на корпусе мотора оказалась совершенно неадекватной.&lt;/p&gt;
&lt;p&gt;Решил попробовать сделать необходимый девайс на Arduino.&lt;/p&gt;
&lt;p&gt;До этого с микроконтроллерами дела не имел. Оказалось, это совсем не сложно и даже интересно.&lt;/p&gt;
&lt;p&gt;Исходники выложил на GitHub: &lt;a
  class=&#34;gblog-markdown__link&#34;
  href=&#34;https://github.com/valmat/BatterySensor&#34;
&gt;https://github.com/valmat/BatterySensor&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Документация там же.&lt;/p&gt;
&lt;p&gt;Прибор умеет отображать уровень заряда батареи в процентах, с помощью значка, а также тремя RGB светодиодами, которые постепенно меняют свои цвета с зелёного на жёлтый, потом на красный — в зависимости от уровня заряда.&lt;/p&gt;
&lt;p&gt;На корпусе расположил выключатель и кнопку. Кнопка выключает светодиоды, а долгое нажатие кнопки отключает подсветку экрана. Для экономии батареи в солнечный день и чтобы не слепило ночью.&lt;/p&gt;
&lt;p&gt;Кроме того, подключил датчик BMP180. Устройство показывает температуру и давление. Давление на рыбалке знать необходимо.&lt;/p&gt;
&lt;p&gt;Корпус сделал герметичным. Всё проклеил резиновым клеем, а сверху заклеил алюминиевым скотчем.&lt;/p&gt;
&lt;p&gt;Работает надёжно. Показания точные.&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;./3.JPG&#34;
  alt=&#34;Корпус устройства, общий вид&#34;
  
/&gt;&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;./4.JPG&#34;
  alt=&#34;Вид устройства с другого ракурса&#34;
  
/&gt;&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;./5.JPG&#34;
  alt=&#34;Внутренности устройства&#34;
  
/&gt;&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;./10.jpg&#34;
  alt=&#34;Экран устройства в работе&#34;
  
/&gt;&lt;/p&gt;

            </content>    
                                <category scheme="https://valmat.ru/tags/archive" term="archive" label="archive" />
        </entry>
        <entry>
            <title>Определение по списку в C&#43;&#43;</title>
            <link href="https://valmat.ru/posts/archive/2014/11/cpp-tolist/" rel="alternate" type="text/html"  hreflang="en" />
            <id>https://valmat.ru/posts/archive/2014/11/cpp-tolist/</id>
            <published>2014-11-18T16:38:00+00:00</published>
            <updated>2014-11-18T16:38:00+00:00</updated>
            <content type="html">
                &lt;p&gt;В PHP есть возможность присвоить переменным значения, используя массив:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-php&#34; data-lang=&#34;php&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;list&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$a&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$b&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;array&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;str1&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;str2&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;В Python это выглядит так:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;b&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;str1&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;str2&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;А вот в C++ такой языковой конструкции нет. Но это совершенно не проблема, потому что ее можно сделать самому.&lt;/p&gt;
&lt;p&gt;Вот что у меня получилось:&lt;/p&gt;
&lt;script src=&#34;https://gist.github.com/valmat/455d9f9c56237b87f7e2.js&#34;&gt;&lt;/script&gt;

&lt;!-- ```cpp
/**
 * This is a helper class.
 * It can be used only inside the function ListInitializer tolist(Args&amp;&amp; ...args)
 * ListInitializer list(Args&amp;&amp; ...args)
 * In all other cases, use it not possible
 * size is the number of arguments with which the constructor was called
 */
template&lt;typename DataType, unsigned size&gt;
class ListInitializer
{
public:

    /**
     * Assignment operator
     * Ref-qualified forbids such things:
     * ListInitializer c(a,b);
     * c = arr;
     * You can only use this form:
     * ListInitializer(a,b) = arr;
     * VecType must be convertable to DataType
     */
    template&lt;typename ContainerType&gt;
    ListInitializer&amp; operator=(ContainerType&amp;&amp; arr) &amp;&amp;
    {
        auto it = arr.begin(), itend = arr.end();
        unsigned i = 0;
        while(it != itend &amp;&amp; i &lt; size) {
            *parr[i] = *it;
            ++it;
            ++i;
        }
        return *this;
    }

    /**
     * Deleted constructors. Forbids such things:
     * tolist q(a,b,c,d,e),w(a,b,c,d,e);
     * w = q;
     * You can only use this form:
     * tolist(a,b,c,d,e) = arr;
     */
    ListInitializer(const ListInitializer&amp; that) = delete;
    ListInitializer() = delete;

private:
    /**
     * Constructor with one argument
     */
    explicit ListInitializer(DataType&amp; arg)
    {
        helper(0, arg);
    }

    /**
     * Constructor with a variable (&gt;1) number of arguments
     * You can use any number of arguments of type DataType in the constructor.
     * tolist(a,b,c,d) = arr;
     * tolist(a,b) = arr;
     */
    template&lt;typename... Args&gt;
    ListInitializer(DataType&amp; arg0, Args&amp;... args)
    {
        helper(0, arg0, args...);
    }

    /**
     * Move constructor
     */
    ListInitializer(ListInitializer&amp;&amp; that)
    {
        for(unsigned i = 0; i &lt; size; ++i) {
            parr[i] = that.parr[i];
            that.parr[i] = nullptr;
        }
    }

    /**
     * Helper method.
     * Allows to initialize the list of any number of arguments.
     * Alternately, one by one makes pointers to the arguments into the internal array.
     */
    template&lt;typename... Args&gt;
    void helper(int ind, DataType&amp; arg0, Args&amp;... args)
    {
        helper(ind, arg0);
        helper(++ind, args...);
    }

    /**
     * Helper method.
     */
    void helper(int ind, DataType&amp; arg0)
    {
        parr[ind] = &amp;arg0;
    }

    template&lt;typename T, typename... Args&gt;
    friend ListInitializer&lt;T, sizeof...(Args)+1&gt; tolist(T&amp; arg0, Args&amp;... args);

    // Internal array of pointers to pointers to arguments
    DataType* parr[size];
};

template&lt;typename DataType, typename... Args&gt;
ListInitializer&lt;DataType, sizeof...(Args)+1&gt; tolist(DataType&amp; arg0, Args&amp;... args)
{
    return ListInitializer&lt;DataType, sizeof...(Args)+1&gt;(arg0, args...);
}

// Check
#include &lt;iostream&gt;
#include &lt;vector&gt;
int main()
{

    std::vector&lt;std::string&gt; arr{&#34;str1&#34;, &#34;str2&#34;, &#34;str3&#34;, &#34;str4&#34;, &#34;str5&#34;, &#34;str6&#34;};
    std::string a, b, c, d, e;

    tolist(b) = arr;
    std::cout &lt;&lt; std::endl &lt;&lt; a &lt;&lt; &#34; &#34; &lt;&lt; b &lt;&lt; &#34; &#34; &lt;&lt; c &lt;&lt; &#34; &#34; &lt;&lt; d &lt;&lt; &#34; &#34; &lt;&lt; e &lt;&lt; std::endl;

    tolist(a, b, c, d, e) = arr;
    std::cout &lt;&lt; std::endl &lt;&lt; a &lt;&lt; &#34; &#34; &lt;&lt; b &lt;&lt; &#34; &#34; &lt;&lt; c &lt;&lt; &#34; &#34; &lt;&lt; d &lt;&lt; &#34; &#34; &lt;&lt; e &lt;&lt; std::endl;

    return 0;
}

/*
 * g++ tolist.cpp -std=c++11 &amp;&amp; ./a.out
 * or 
 * clang++ tolist.cpp -std=c++11 &amp;&amp; ./a.out
 *
 * |output:
 * | str1
 * |
 * |str1 str2 str3 str4 str5
 *
 */
``` --&gt;
&lt;p&gt;См также &lt;a
  class=&#34;gblog-markdown__link&#34;
  href=&#34;https://gist.github.com/valmat/fdb37d1b741d5c12336d&#34;
&gt;Optimized string concatenation: strjoin.cpp&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Нужен C++11, т.к. используются Ref-qualifiers.&lt;/p&gt;
&lt;p&gt;P.S. blogger.com как всегда портит код. Надо менять блогодвижок.&lt;/p&gt;

            </content>    
                                <category scheme="https://valmat.ru/tags/archive" term="archive" label="archive" />
        </entry>
        <entry>
            <title>Микро-бенчмарк RocksDB server</title>
            <link href="https://valmat.ru/posts/archive/2014/08/rocksdb-mikro-bench/" rel="alternate" type="text/html"  hreflang="en" />
            <id>https://valmat.ru/posts/archive/2014/08/rocksdb-mikro-bench/</id>
            <published>2014-08-21T06:00:00+00:00</published>
            <updated>2014-08-21T06:00:00+00:00</updated>
            <content type="html">
                &lt;p&gt;В полноценном смысле то, что я тут хочу написать, конечно, бенчмарком не является. Но вполне способно дать понимание области применения RocksDB.&lt;/p&gt;
&lt;p&gt;RocksDB — это довольно крутое хранилище, являющееся (на данный момент) встраиваемым решением. Главной фишкой RocksDB является то, что она рассчитана на использование на flash-накопителях, то есть на SSD-дисках.&lt;/p&gt;
&lt;p&gt;Лично я давно ждал появления таких решений. Поскольку память всё ещё дорогая, а жёсткие диски медленные, использование SSD для хранения данных — очень логичный шаг.&lt;/p&gt;
&lt;p&gt;Как я уже говорил, RocksDB — встраиваемое решение и не является сервером. Я честно ждал почти год, когда кто-нибудь напишет или хотя бы начнёт писать серверную обёртку над ней. Но то, что появилось за это время, по разным причинам категорически меня не устраивает.&lt;/p&gt;
&lt;p&gt;Поэтому я написал собственную серверную обёртку: &lt;a
  class=&#34;gblog-markdown__link&#34;
  href=&#34;https://github.com/valmat/RocksServer&#34;
&gt;https://github.com/valmat/RocksServer&lt;/a&gt;. В настоящее время она вполне функциональна, протестирована и готова к работе. Но есть ещё моменты, требующие улучшения. Эти моменты никак не связаны с её пригодностью к использованию, поэтому ничто не мешает уже сейчас произвести замеры производительности.&lt;/p&gt;
&lt;p&gt;Замеры я осуществлял с помощью идущего в комплекте с сервером драйвера для PHP. Во-первых, мне так было удобнее, а во-вторых, использовать я его в ближайшее время буду именно из PHP.&lt;/p&gt;
&lt;p&gt;Итак, табличка.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;MultiGet со случайными ключами.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Условия проведения эксперимента:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;В базе данных 1 000 000 ключей.&lt;/li&gt;
&lt;li&gt;Выбирается набор случайных ключей в случайном порядке.&lt;/li&gt;
&lt;li&gt;Кэш не используется. Прямо перед экспериментом я перезагрузил компьютер, чтобы полностью исключить возможность использования файлового кэша.&lt;/li&gt;
&lt;li&gt;Хранимые значения имеют длину 50 ±5 байт.&lt;/li&gt;
&lt;/ul&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;Количество ключей в выборке&lt;/th&gt;
          &lt;th&gt;SSD&lt;/th&gt;
          &lt;th&gt;HDD&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;50&lt;/td&gt;
          &lt;td&gt;4.7 ms&lt;/td&gt;
          &lt;td&gt;131.3 ms&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;300&lt;/td&gt;
          &lt;td&gt;12.6 ms&lt;/td&gt;
          &lt;td&gt;2371.4 ms (~2s)&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;1000&lt;/td&gt;
          &lt;td&gt;29.5 ms&lt;/td&gt;
          &lt;td&gt;7918.4 ms (~8s)&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;10 000&lt;/td&gt;
          &lt;td&gt;124.6 ms&lt;/td&gt;
          &lt;td&gt;45229.5 ms (~45s)&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;100 000&lt;/td&gt;
          &lt;td&gt;2346.6 ms&lt;/td&gt;
          &lt;td&gt;51855.8 ms (~56s)&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Следует отметить, что после попадания ключей в кэш скорость выборки на HDD возрастает и приближается к скорости выборки на SSD.&lt;/p&gt;
&lt;p&gt;Какие выводы можно сделать из таблички? RocksDB действительно очень быстрое хранилище и подходит для использования на SSD-дисках.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;P.S.&lt;/strong&gt; Сама RocksDB обладает очень богатыми возможностями. В настоящий момент я реализовал лишь базовый необходимый мне функционал. В дальнейшем, постепенно, я планирую наращивать функциональные возможности RocksServer.&lt;/p&gt;

            </content>    
                                <category scheme="https://valmat.ru/tags/archive" term="archive" label="archive" />
        </entry>
        <entry>
            <title>Clang vs gcc performance</title>
            <link href="https://valmat.ru/posts/archive/2014/05/clang-vs-gcc-performance/" rel="alternate" type="text/html"  hreflang="en" />
            <id>https://valmat.ru/posts/archive/2014/05/clang-vs-gcc-performance/</id>
            <published>2014-05-31T21:18:00+00:00</published>
            <updated>2014-05-31T21:18:00+00:00</updated>
            <content type="html">
                &lt;p&gt;Стало мне интересно, и решил я провести такую глупую проверку: сравнить производительность программ, откомпилированных Clang&amp;rsquo;ом и gcc.&lt;/p&gt;
&lt;p&gt;Для эксперимента взял первую попавшуюся реализацию пузырьковой сортировки с GitHub&amp;rsquo;а.&lt;/p&gt;
&lt;p&gt;Компилировал с опциями &lt;code&gt;-g&lt;/code&gt;, &lt;code&gt;-O1&lt;/code&gt;, &lt;code&gt;-O2&lt;/code&gt;, &lt;code&gt;-O3&lt;/code&gt; и без опций.&lt;/p&gt;
&lt;p&gt;Получилось интересно и неожиданно.&lt;/p&gt;
&lt;p&gt;Для запуска тестов использовал такой скрипт:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#!/bin/bash
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;OPT&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;-O3&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;g++ &lt;span class=&#34;nv&#34;&gt;$OPT&lt;/span&gt; bubble.cpp -o bubble1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;clang++ &lt;span class=&#34;nv&#34;&gt;$OPT&lt;/span&gt; bubble.cpp -o bubble2   &lt;span class=&#34;c1&#34;&gt;# -stdlib=libstdc++&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;clang++ &lt;span class=&#34;nv&#34;&gt;$OPT&lt;/span&gt; -stdlib&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;libc++ bubble.cpp -o bubble3 &lt;span class=&#34;c1&#34;&gt;# -stdlib=libc++&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# ls -slh&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# exit;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sleep &lt;span class=&#34;m&#34;&gt;3&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;time&lt;/span&gt; ./bubble1 &amp;gt; /dev/null
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sleep &lt;span class=&#34;m&#34;&gt;3&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;time&lt;/span&gt; ./bubble2 &amp;gt; /dev/null
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sleep &lt;span class=&#34;m&#34;&gt;3&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;time&lt;/span&gt; ./bubble3 &amp;gt; /dev/null
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Меняя параметр &lt;code&gt;OPT&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Поясню, что здесь компилируется:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;g++ $OPT bubble.cpp -o bubble1&lt;/code&gt;&lt;br&gt;
Используется &lt;strong&gt;gcc&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;clang++ $OPT bubble.cpp -o bubble2&lt;/code&gt;&lt;br&gt;
Используется &lt;strong&gt;clang&lt;/strong&gt; со стандартной библиотекой &lt;strong&gt;libstdc++&lt;/strong&gt; от gcc&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;clang++ $OPT -stdlib=libc++ bubble.cpp -o bubble3&lt;/code&gt;&lt;br&gt;
Используется &lt;strong&gt;clang&lt;/strong&gt; со своей собственной стандартной библиотекой &lt;strong&gt;libc++&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;flex align-center gblog-post__anchorwrap&#34;&gt;
    &lt;h3 id=&#34;результаты-производительности&#34;
    &gt;
        Результаты производительности
    &lt;/h3&gt;
    &lt;a data-clipboard-text=&#34;https://valmat.ru/posts/archive/2014/05/clang-vs-gcc-performance/#результаты-производительности&#34; class=&#34;gblog-post__anchor clip flex align-center&#34; aria-label=&#34;Anchor Результаты производительности&#34; href=&#34;#%d1%80%d0%b5%d0%b7%d1%83%d0%bb%d1%8c%d1%82%d0%b0%d1%82%d1%8b-%d0%bf%d1%80%d0%be%d0%b8%d0%b7%d0%b2%d0%be%d0%b4%d0%b8%d1%82%d0%b5%d0%bb%d1%8c%d0%bd%d0%be%d1%81%d1%82%d0%b8&#34;&gt;
        &lt;svg class=&#34;gblog-icon gblog_link&#34;&gt;&lt;use xlink:href=&#34;#gblog_link&#34;&gt;&lt;/use&gt;&lt;/svg&gt;
    &lt;/a&gt;
&lt;/div&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;Опция&lt;/th&gt;
          &lt;th&gt;gcc&lt;/th&gt;
          &lt;th&gt;clang -stdlib=libstdc++ (gcc)&lt;/th&gt;
          &lt;th&gt;clang -stdlib=libc++&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;-g&lt;/td&gt;
          &lt;td&gt;real &lt;strong&gt;0m3.337&lt;/strong&gt;s&lt;br&gt;user 0m3.335s&lt;br&gt;sys 0m0.004s&lt;/td&gt;
          &lt;td&gt;real &lt;strong&gt;0m3.294&lt;/strong&gt;s&lt;br&gt;user 0m3.296s&lt;br&gt;sys 0m0.000s&lt;/td&gt;
          &lt;td&gt;real &lt;strong&gt;0m3.323&lt;/strong&gt;s&lt;br&gt;user 0m3.325s&lt;br&gt;sys 0m0.000s&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;без опций&lt;/td&gt;
          &lt;td&gt;real &lt;strong&gt;0m3.334&lt;/strong&gt;s&lt;br&gt;user 0m3.336s&lt;br&gt;sys 0m0.000s&lt;/td&gt;
          &lt;td&gt;real &lt;strong&gt;0m3.293&lt;/strong&gt;s&lt;br&gt;user 0m3.295s&lt;br&gt;sys 0m0.000s&lt;/td&gt;
          &lt;td&gt;real &lt;strong&gt;0m3.320&lt;/strong&gt;s&lt;br&gt;user 0m3.318s&lt;br&gt;sys 0m0.004s&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;-O1&lt;/td&gt;
          &lt;td&gt;real &lt;strong&gt;0m1.735&lt;/strong&gt;s&lt;br&gt;user 0m1.735s&lt;br&gt;sys 0m0.000s&lt;/td&gt;
          &lt;td&gt;real &lt;strong&gt;0m1.485&lt;/strong&gt;s&lt;br&gt;user 0m1.486s&lt;br&gt;sys 0m0.000s&lt;/td&gt;
          &lt;td&gt;real &lt;strong&gt;0m1.493&lt;/strong&gt;s&lt;br&gt;user 0m1.494s&lt;br&gt;sys 0m0.000s&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;-O2&lt;/td&gt;
          &lt;td&gt;real &lt;strong&gt;0m1.516&lt;/strong&gt;s&lt;br&gt;user 0m1.517s&lt;br&gt;sys 0m0.000s&lt;/td&gt;
          &lt;td&gt;real &lt;strong&gt;0m1.522&lt;/strong&gt;s&lt;br&gt;user 0m1.523s&lt;br&gt;sys 0m0.000s&lt;/td&gt;
          &lt;td&gt;real &lt;strong&gt;0m1.495&lt;/strong&gt;s&lt;br&gt;user 0m1.492s&lt;br&gt;sys 0m0.004s&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;-O3&lt;/td&gt;
          &lt;td&gt;real &lt;strong&gt;0m1.510&lt;/strong&gt;s&lt;br&gt;user 0m1.506s&lt;br&gt;sys 0m0.004s&lt;/td&gt;
          &lt;td&gt;real &lt;strong&gt;0m1.534&lt;/strong&gt;s&lt;br&gt;user 0m1.535s&lt;br&gt;sys 0m0.000s&lt;/td&gt;
          &lt;td&gt;real &lt;strong&gt;0m1.498&lt;/strong&gt;s&lt;br&gt;user 0m1.499s&lt;br&gt;sys 0m0.000s&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;div class=&#34;flex align-center gblog-post__anchorwrap&#34;&gt;
    &lt;h3 id=&#34;размеры-бинарников&#34;
    &gt;
        Размеры бинарников
    &lt;/h3&gt;
    &lt;a data-clipboard-text=&#34;https://valmat.ru/posts/archive/2014/05/clang-vs-gcc-performance/#размеры-бинарников&#34; class=&#34;gblog-post__anchor clip flex align-center&#34; aria-label=&#34;Anchor Размеры бинарников&#34; href=&#34;#%d1%80%d0%b0%d0%b7%d0%bc%d0%b5%d1%80%d1%8b-%d0%b1%d0%b8%d0%bd%d0%b0%d1%80%d0%bd%d0%b8%d0%ba%d0%be%d0%b2&#34;&gt;
        &lt;svg class=&#34;gblog-icon gblog_link&#34;&gt;&lt;use xlink:href=&#34;#gblog_link&#34;&gt;&lt;/use&gt;&lt;/svg&gt;
    &lt;/a&gt;
&lt;/div&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;Опция&lt;/th&gt;
          &lt;th&gt;gcc&lt;/th&gt;
          &lt;th&gt;clang -stdlib=libstdc++ (gcc)&lt;/th&gt;
          &lt;th&gt;clang -stdlib=libc++&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;-g&lt;/td&gt;
          &lt;td&gt;22K&lt;/td&gt;
          &lt;td&gt;28K&lt;/td&gt;
          &lt;td&gt;65K&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;без опций&lt;/td&gt;
          &lt;td&gt;9,2K&lt;/td&gt;
          &lt;td&gt;8,3K&lt;/td&gt;
          &lt;td&gt;15K&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;-O1&lt;/td&gt;
          &lt;td&gt;8,9K&lt;/td&gt;
          &lt;td&gt;8,4K&lt;/td&gt;
          &lt;td&gt;12K&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;-O2&lt;/td&gt;
          &lt;td&gt;8,9K&lt;/td&gt;
          &lt;td&gt;8,1K&lt;/td&gt;
          &lt;td&gt;12K&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;-O3&lt;/td&gt;
          &lt;td&gt;8,9K&lt;/td&gt;
          &lt;td&gt;8,1K&lt;/td&gt;
          &lt;td&gt;12K&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Понятно, что по такому примеру корректно сравнивать компиляторы нельзя, но для меня, как для приверженца GNU компилятора, результаты получились неожиданными.&lt;/p&gt;
&lt;p&gt;По сути, clang превзошёл gcc во всех направлениях.&lt;/p&gt;
&lt;p&gt;Для меня основной вывод такой:&lt;br&gt;
Clang заслуживает внимания и заслуживает того, чтобы к нему присмотреться. Тем более, сообщения об ошибках, которые он выдаёт, информативнее, чем сообщения, выдаваемые gcc.&lt;/p&gt;
&lt;p&gt;До этого я никогда не пользовался клэнгом (силангом). Столкнулся с ним по необходимости. Думаю, что стоит попробовать использовать его в своей работе.&lt;/p&gt;
&lt;p&gt;Мои версии clang и gcc:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;gcc version 4.8.1&lt;/strong&gt; (Ubuntu/Linaro 4.8.1-10ubuntu9)&lt;/li&gt;
&lt;li&gt;Debian &lt;strong&gt;clang version 3.2&lt;/strong&gt;-7ubuntu1 (tags/RELEASE_32/final) (based on LLVM 3.2)&lt;/li&gt;
&lt;/ul&gt;

            </content>    
                                <category scheme="https://valmat.ru/tags/archive" term="archive" label="archive" />
        </entry>
        <entry>
            <title>Отчетность в налоговую на Linux</title>
            <link href="https://valmat.ru/posts/archive/2014/03/linux/" rel="alternate" type="text/html"  hreflang="en" />
            <id>https://valmat.ru/posts/archive/2014/03/linux/</id>
            <published>2014-03-20T10:43:00+00:00</published>
            <updated>2014-03-20T10:43:00+00:00</updated>
            <content type="html">
                &lt;p&gt;Как я готовлю отчетность в налоговую.&lt;/p&gt;
&lt;p&gt;Выписки у меня достаются в таком формате:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;2014.01.20.rtf&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;2014.01.20-1.rtf&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&amp;hellip;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;В первую очередь, нужно упорядочить по дате, поэтому переименовываем:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; i in &lt;span class=&#34;sb&#34;&gt;`&lt;/span&gt;find . -type f -name &lt;span class=&#34;s2&#34;&gt;&amp;#34;*.rtf*&amp;#34;&lt;/span&gt;&lt;span class=&#34;sb&#34;&gt;`&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nv&#34;&gt;dst&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;sb&#34;&gt;`&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; sed -e :a -e &lt;span class=&#34;s1&#34;&gt;&amp;#39;s/\(.*\)\([0-9]\{2\}\)\.\([0-9]\{2\}\)\.\([0-9]\{4\}\)\(.*\)/\1\4.\3.\2\5/;ta&amp;#39;&lt;/span&gt;&lt;span class=&#34;sb&#34;&gt;`&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; mv &lt;span class=&#34;nv&#34;&gt;$i&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$dst&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;done&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Потом конвертируем в PDF:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;libreoffice --invisible --convert-to pdf *.rtf
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;И соединяем все в один файл:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;gs -dNOPAUSE -sDEVICE&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;pdfwrite -sOUTPUTFILE&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;toprint.pdf -dBATCH &lt;span class=&#34;sb&#34;&gt;`&lt;/span&gt;find . -type f -name &lt;span class=&#34;s2&#34;&gt;&amp;#34;*.pdf&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; sort&lt;span class=&#34;sb&#34;&gt;`&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Всё.&lt;/p&gt;

            </content>    
                                <category scheme="https://valmat.ru/tags/archive" term="archive" label="archive" />
        </entry>
        <entry>
            <title>Документация PHP-CPP</title>
            <link href="https://valmat.ru/posts/archive/2014/03/documentation-php-cpp-start/" rel="alternate" type="text/html"  hreflang="en" />
            <id>https://valmat.ru/posts/archive/2014/03/documentation-php-cpp-start/</id>
            <published>2014-03-10T18:42:00+00:00</published>
            <updated>2014-03-10T18:42:00+00:00</updated>
            <content type="html">
                &lt;p&gt;У PHP-CPP появился раздел с &lt;a
  class=&#34;gblog-markdown__link&#34;
  href=&#34;http://www.php-cpp.com/documentation&#34;
&gt;документацией&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Вообще разработка библиотеки идет семимильными шагами, и, похоже, недолго осталось ждать первого рабочего релиза. Когда будет готово, напишу подробнее про саму библиотеку и её возможности.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;PS: Вместо того чтобы что-то писать здесь про библиотеку, я просто взял и начал переводить документацию на русский язык: &lt;a
  class=&#34;gblog-markdown__link&#34;
  href=&#34;http://phpcpp.ru/&#34;
&gt;http://phpcpp.ru/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Основная цель этого перевода — познакомить русскоязычное сообщество с библиотекой.&lt;/p&gt;
&lt;p&gt;Перевод вольный. Поскольку многие вещи в библиотеке так или иначе сделаны с моим участием (да и просто потому что я уже достаточно хорошо в ней разобрался), мой перевод во многих местах дополняет и расширяет оригинальный текст.&lt;/p&gt;

            </content>    
                                <category scheme="https://valmat.ru/tags/archive" term="archive" label="archive" />
        </entry>
        <entry>
            <title>Сравнение производительности C&#43;&#43; php-расширения с нативным кодом</title>
            <link href="https://valmat.ru/posts/archive/2014/01/php-cpp-pagination/" rel="alternate" type="text/html"  hreflang="en" />
            <id>https://valmat.ru/posts/archive/2014/01/php-cpp-pagination/</id>
            <published>2014-01-12T15:11:00+00:00</published>
            <updated>2014-01-12T15:11:00+00:00</updated>
            <content type="html">
                &lt;p&gt;Давно меня интересовал вопрос: насколько увеличивается производительность при переписывании нативного кода в php-расширение.&lt;/p&gt;
&lt;p&gt;И вот я решил провести сравнение.&lt;/p&gt;
&lt;p&gt;В качестве платформы для написания расширения была выбрана библиотека &lt;a
  class=&#34;gblog-markdown__link&#34;
  href=&#34;https://github.com/CopernicaMarketingSoftware/PHP-CPP&#34;
&gt;PHP-CPP&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Пару слов о самой библиотеке PHP-CPP.&lt;/strong&gt;&lt;br&gt;
Довольно неплохая библиотека. Работать с ней приятно и удобно. Честно говоря, никогда еще не было так легко писать расширения для php.&lt;br&gt;
Из минусов могу отметить недостаток документации. Чтобы разобраться с некоторыми вещами, недостаточно даже примеров, которыми автор снабжает код — приходится смотреть исходники. В частности, я так и не разобрался, как перенести статический метод класса из C++ в статический же метод в php.&lt;br&gt;
Основана она на C++11, т.е. на старых дистрибутивах может потребоваться обновить gcc.&lt;/p&gt;
&lt;p&gt;В качестве подопытного был выбран модуль постраничного разбиения.&lt;br&gt;
Исходники на GitHub: &lt;a
  class=&#34;gblog-markdown__link&#34;
  href=&#34;https://github.com/valmat/myscrnav&#34;
&gt;https://github.com/valmat/myscrnav&lt;/a&gt;&lt;br&gt;
Я написал два идентичных класса: один на php, другой на C++ (в виде расширения к php).&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Пару слов как пользоваться.&lt;/strong&gt;&lt;br&gt;
Пример использования есть в исходниках: &lt;a
  class=&#34;gblog-markdown__link&#34;
  href=&#34;https://github.com/valmat/myscrnav/blob/master/screennav_test.php&#34;
&gt;https://github.com/valmat/myscrnav/blob/master/screennav_test.php&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Создаем pagination-объект из расширения:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-php&#34; data-lang=&#34;php&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$scr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;myScrNav&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$pageNom&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$Count&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;/url/to/page/&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Или из php-класса:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-php&#34; data-lang=&#34;php&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;require&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;php/class.screennav.php&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$scr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ScreenNav&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$pageNom&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$Count&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;/url/to/page/&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Задаём необходимые параметры (если необходимо, можно не задавать):&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-php&#34; data-lang=&#34;php&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$scr&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;setInterval&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;10&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;       &lt;span class=&#34;c1&#34;&gt;// Сколько объектов на странице
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$scr&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;setPrefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;?qwe&amp;amp;part=&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// URL prefix
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$scr&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;setPostfix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;amp;prm=132&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// URL postfix
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$scr&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;setSpace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;lt;space&amp;gt;...&amp;lt;/space&amp;gt;&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// Разделитель блоков табов
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$scr&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;setCssName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;newClassName&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;     &lt;span class=&#34;c1&#34;&gt;// Имя класса css блока управления постраничным выводом
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$scr&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;setMidTab&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;15&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;          &lt;span class=&#34;c1&#34;&gt;// см. info.png
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$scr&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;setMaxTab&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;           &lt;span class=&#34;c1&#34;&gt;// см. info.png
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$scr&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;showCount&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;        &lt;span class=&#34;c1&#34;&gt;// Показывать ли общее количество элементов
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img
  src=&#34;./info.png&#34;
  alt=&#34;info.png&#34;
  
/&gt;&lt;/p&gt;
&lt;p&gt;Кроме того, доступны следующие методы для получения вычисленных данных:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-php&#34; data-lang=&#34;php&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;getStartPos&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;   &lt;span class=&#34;c1&#34;&gt;// Номер начального элемента на текущей странице (для выборки из БД)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;getLimitPos&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;   &lt;span class=&#34;c1&#34;&gt;// Длина списка элементов на странице на текущей странице (для выборки из БД)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;getPageCnt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// Количество страниц при разбивке на части
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;getStartPos&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;   &lt;span class=&#34;c1&#34;&gt;// Номер (вычисленный) текущей страницы
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;show&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;          &lt;span class=&#34;c1&#34;&gt;// Возвращает собственно сам элемент управления постраничной разбивкой (html)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;То есть можно управлять постраничной разбивкой и делать запросы к БД на основе этой разбивки. Внешний вид, разумеется, полностью настраивается через css.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Теперь сами результаты сравнения.&lt;/strong&gt;&lt;br&gt;
PHP тестируется с включённым опкешером (apc). Без него смысла тестировать не вижу, ибо тестировать нужно так, как используется на рабочей системе.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;1&lt;/strong&gt;&lt;br&gt;
Во-первых, сравним просто функции.&lt;/p&gt;
&lt;p&gt;На php будет:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-php&#34; data-lang=&#34;php&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;ScreenNav_pageNo&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$var&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;isset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$_GET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$var&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]))&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;?&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$_GET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$var&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;На C++:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Php&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Value&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;GETpageNom&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Php&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Parameters&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;params&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;params&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;string&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Php&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;params&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]))&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;stringValue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;string&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Php&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;globals&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;_GET&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;][&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;var&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kt&#34;&gt;long&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;rez&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Php&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;numericValue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;rez&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;?&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rez&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;php&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;memory usage: 0.56Kb&lt;/li&gt;
&lt;li&gt;memory peak_usage: 1.1Kb&lt;/li&gt;
&lt;li&gt;Вычисленное: time: 50·10⁻⁶ sec&lt;/li&gt;
&lt;li&gt;ab -n 10000 &amp;hellip; : Time per request: 0.39 [ms] (mean)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;C++&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;memory usage: 1.26Kb&lt;/li&gt;
&lt;li&gt;memory peak_usage: 1.8Kb&lt;/li&gt;
&lt;li&gt;Вычисленное: time: 60·10⁻⁶ sec&lt;/li&gt;
&lt;li&gt;ab -n 10000 &amp;hellip; : Time per request: 0.4 [ms] (mean)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Как видно, на таком простом примере расширение не выигрывает, а даже проигрывает нативному коду.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;2&lt;/strong&gt;&lt;br&gt;
Теперь сравним классы.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;php&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;time: 215·10⁻⁶ sec&lt;/li&gt;
&lt;li&gt;memory usage: 16.5Kb&lt;/li&gt;
&lt;li&gt;memory peak_usage: 22.7Kb&lt;/li&gt;
&lt;li&gt;ab -n 10000 &amp;hellip; : Time per request: 0.533 [ms] (mean)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;C++&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;time: 170·10⁻⁶ sec&lt;/li&gt;
&lt;li&gt;memory usage: 2.3Kb&lt;/li&gt;
&lt;li&gt;memory peak_usage: 4.6Kb&lt;/li&gt;
&lt;li&gt;ab -n 10000 &amp;hellip; : Time per request: 0.49 [ms] (mean)&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;div class=&#34;flex align-center gblog-post__anchorwrap&#34;&gt;
    &lt;h2 id=&#34;выводы&#34;
    &gt;
        Выводы
    &lt;/h2&gt;
    &lt;a data-clipboard-text=&#34;https://valmat.ru/posts/archive/2014/01/php-cpp-pagination/#выводы&#34; class=&#34;gblog-post__anchor clip flex align-center&#34; aria-label=&#34;Anchor Выводы&#34; href=&#34;#%d0%b2%d1%8b%d0%b2%d0%be%d0%b4%d1%8b&#34;&gt;
        &lt;svg class=&#34;gblog-icon gblog_link&#34;&gt;&lt;use xlink:href=&#34;#gblog_link&#34;&gt;&lt;/use&gt;&lt;/svg&gt;
    &lt;/a&gt;
&lt;/div&gt;
&lt;p&gt;Разница во времени порядка 10⁻⁵ sec — не то, ради чего нужно переписывать с php на C++.&lt;br&gt;
С другой стороны, само то, что она проявилась на такой незначительной задаче — уже результат.&lt;br&gt;
Приведённый пример позволяет понять порядок выигрыша и оценить целесообразность переписывания нативного кода в C++ расширение.&lt;/p&gt;
&lt;p&gt;Обращает на себя внимание разница в потреблении памяти. Причём, если расширение выгрузить, то потребление памяти нативным кодом не уменьшается.&lt;/p&gt;

            </content>    
                                <category scheme="https://valmat.ru/tags/archive" term="archive" label="archive" />
        </entry>
        <entry>
            <title>Сериализация в PHP</title>
            <link href="https://valmat.ru/posts/archive/2013/12/serialize-php/" rel="alternate" type="text/html"  hreflang="en" />
            <id>https://valmat.ru/posts/archive/2013/12/serialize-php/</id>
            <published>2013-12-15T19:08:00+00:00</published>
            <updated>2013-12-15T19:08:00+00:00</updated>
            <content type="html">
                &lt;p&gt;Будут сравниваться 4 способа сериализации:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Стандартная сериализация &lt;code&gt;serialize&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;JSON&lt;/li&gt;
&lt;li&gt;msgpack&lt;/li&gt;
&lt;li&gt;igbinary&lt;/li&gt;
&lt;/ol&gt;



  &lt;div class=&#34;gblog-toc gblog-toc__level--6&#34;&gt;
    &lt;nav id=&#34;TableOfContents&#34;&gt;
  &lt;ul&gt;
    &lt;li&gt;
      &lt;ul&gt;
        &lt;li&gt;&lt;a href=&#34;#кратко-об-установке&#34;&gt;Кратко об установке&lt;/a&gt;&lt;/li&gt;
        &lt;li&gt;&lt;a href=&#34;#что-еще-важно-отметить&#34;&gt;Что еще важно отметить&lt;/a&gt;&lt;/li&gt;
        &lt;li&gt;&lt;a href=&#34;#тесты&#34;&gt;Тесты&lt;/a&gt;
          &lt;ul&gt;
            &lt;li&gt;&lt;a href=&#34;#1-массив-ассоциативный-вложенные-массивы-и-строки&#34;&gt;1. Массив ассоциативный: вложенные массивы и строки&lt;/a&gt;&lt;/li&gt;
            &lt;li&gt;&lt;a href=&#34;#2-массив-числовой-большие-массивы-целых-чисел&#34;&gt;2. Массив числовой: большие массивы целых чисел&lt;/a&gt;&lt;/li&gt;
            &lt;li&gt;&lt;a href=&#34;#3-массив-числовой-большие-массивы-длинных-целых-чисел-int64&#34;&gt;3. Массив числовой: большие массивы длинных целых чисел (int64)&lt;/a&gt;&lt;/li&gt;
            &lt;li&gt;&lt;a href=&#34;#4-массив-числовой-большие-массивы-чисел-с-плавающей-точкой-float&#34;&gt;4. Массив числовой: большие массивы чисел с плавающей точкой (float)&lt;/a&gt;&lt;/li&gt;
            &lt;li&gt;&lt;a href=&#34;#5-массив-строковый-большие-массивы-длинных-строк&#34;&gt;5. Массив строковый: большие массивы длинных строк&lt;/a&gt;&lt;/li&gt;
          &lt;/ul&gt;
        &lt;/li&gt;
      &lt;/ul&gt;
    &lt;/li&gt;
  &lt;/ul&gt;
&lt;/nav&gt;
    &lt;hr /&gt;
  &lt;/div&gt;


&lt;div class=&#34;flex align-center gblog-post__anchorwrap&#34;&gt;
    &lt;h2 id=&#34;кратко-об-установке&#34;
    &gt;
        Кратко об установке
    &lt;/h2&gt;
    &lt;a data-clipboard-text=&#34;https://valmat.ru/posts/archive/2013/12/serialize-php/#кратко-об-установке&#34; class=&#34;gblog-post__anchor clip flex align-center&#34; aria-label=&#34;Anchor Кратко об установке&#34; href=&#34;#%d0%ba%d1%80%d0%b0%d1%82%d0%ba%d0%be-%d0%be%d0%b1-%d1%83%d1%81%d1%82%d0%b0%d0%bd%d0%be%d0%b2%d0%ba%d0%b5&#34;&gt;
        &lt;svg class=&#34;gblog-icon gblog_link&#34;&gt;&lt;use xlink:href=&#34;#gblog_link&#34;&gt;&lt;/use&gt;&lt;/svg&gt;
    &lt;/a&gt;
&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;JSON&lt;/strong&gt; раньше шел в стандартной поставке PHP. Сейчас нужно поставить дополнительное расширение &lt;code&gt;php5-json&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;msgpack&lt;/strong&gt;&lt;br&gt;
Сайт: &lt;a
  class=&#34;gblog-markdown__link&#34;
  href=&#34;http://msgpack.org/&#34;
&gt;http://msgpack.org/&lt;/a&gt;&lt;br&gt;
Исходники: &lt;a
  class=&#34;gblog-markdown__link&#34;
  href=&#34;https://github.com/msgpack/msgpack-php&#34;
&gt;github.com/msgpack/msgpack-php&lt;/a&gt; и &lt;a
  class=&#34;gblog-markdown__link&#34;
  href=&#34;http://pecl.php.net/package/msgpack&#34;
&gt;http://pecl.php.net/package/msgpack&lt;/a&gt;&lt;br&gt;
Ставим:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; /tmp
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;wget http://pecl.php.net/get/msgpack-0.5.5.tgz
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tar xzf msgpack-0.5.5.tgz
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; msgpack-0.5.5
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;phpize
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;./configure
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;make
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;make &lt;span class=&#34;nb&#34;&gt;test&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Если тесты прошли нормально, то создаем пакет и ставим:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo checkinstall -D --install&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;no
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo dpkg -i msgpack_0.5.5-1_amd64.deb
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;igbinary&lt;/strong&gt;&lt;br&gt;
Исходники: &lt;a
  class=&#34;gblog-markdown__link&#34;
  href=&#34;https://github.com/phadej/igbinary/tree/master&#34;
&gt;github.com/phadej/igbinary&lt;/a&gt; и &lt;a
  class=&#34;gblog-markdown__link&#34;
  href=&#34;http://pecl.php.net/package/igbinary&#34;
&gt;http://pecl.php.net/package/igbinary&lt;/a&gt;&lt;br&gt;
Далее опять:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; /tmp
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;wget http://pecl.php.net/get/igbinary-1.1.1.tgz
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tar xzf igbinary-1.1.1.tgz
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; igbinary-1.1.1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;phpize
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;./configure
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;make
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;make &lt;span class=&#34;nb&#34;&gt;test&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo checkinstall -D --install&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;no
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo dpkg -i igbinary_1.1.1-1_amd64.deb
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;msgpack добавляет функции:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-php&#34; data-lang=&#34;php&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;BinData&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;msgpack_pack&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;phpValue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;phpValue&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;msgpack_unpack&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;BinData&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;igbinary добавляет функции:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-php&#34; data-lang=&#34;php&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;BinData&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;igbinary_serialize&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;phpValue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;phpValue&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;igbinary_unserialize&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$BinData&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Чтобы они заработали, нужно не забыть включить их в php.ini:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-ini&#34; data-lang=&#34;ini&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;[igbinary]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;extension&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;igbinary.so&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;; Enable or disable compacting of duplicate strings&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;; The default is On.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;;igbinary.compact_strings=On&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;[msgpack]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;extension&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;msgpack.so&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;flex align-center gblog-post__anchorwrap&#34;&gt;
    &lt;h2 id=&#34;что-еще-важно-отметить&#34;
    &gt;
        Что еще важно отметить
    &lt;/h2&gt;
    &lt;a data-clipboard-text=&#34;https://valmat.ru/posts/archive/2013/12/serialize-php/#что-еще-важно-отметить&#34; class=&#34;gblog-post__anchor clip flex align-center&#34; aria-label=&#34;Anchor Что еще важно отметить&#34; href=&#34;#%d1%87%d1%82%d0%be-%d0%b5%d1%89%d0%b5-%d0%b2%d0%b0%d0%b6%d0%bd%d0%be-%d0%be%d1%82%d0%bc%d0%b5%d1%82%d0%b8%d1%82%d1%8c&#34;&gt;
        &lt;svg class=&#34;gblog-icon gblog_link&#34;&gt;&lt;use xlink:href=&#34;#gblog_link&#34;&gt;&lt;/use&gt;&lt;/svg&gt;
    &lt;/a&gt;
&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;serialize&lt;/code&gt; — стандартная функция PHP.&lt;/li&gt;
&lt;li&gt;JSON — старое и стабильное расширение.&lt;/li&gt;
&lt;li&gt;igbinary — тоже достаточно старая библиотека, давно вышедшая в стабильную ветку.&lt;/li&gt;
&lt;li&gt;msgpack — на данный момент все еще находится в стадии beta. С msgpack мне реально доводилось ловить глюки в ее предыдущих релизах. И если я решусь внедрять ее в продакшен, то только там, где ее ошибки не принесут фатального ущерба.&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;flex align-center gblog-post__anchorwrap&#34;&gt;
    &lt;h2 id=&#34;тесты&#34;
    &gt;
        Тесты
    &lt;/h2&gt;
    &lt;a data-clipboard-text=&#34;https://valmat.ru/posts/archive/2013/12/serialize-php/#тесты&#34; class=&#34;gblog-post__anchor clip flex align-center&#34; aria-label=&#34;Anchor Тесты&#34; href=&#34;#%d1%82%d0%b5%d1%81%d1%82%d1%8b&#34;&gt;
        &lt;svg class=&#34;gblog-icon gblog_link&#34;&gt;&lt;use xlink:href=&#34;#gblog_link&#34;&gt;&lt;/use&gt;&lt;/svg&gt;
    &lt;/a&gt;
&lt;/div&gt;
&lt;hr&gt;
&lt;div class=&#34;flex align-center gblog-post__anchorwrap&#34;&gt;
    &lt;h3 id=&#34;1-массив-ассоциативный-вложенные-массивы-и-строки&#34;
    &gt;
        1. Массив ассоциативный: вложенные массивы и строки
    &lt;/h3&gt;
    &lt;a data-clipboard-text=&#34;https://valmat.ru/posts/archive/2013/12/serialize-php/#1-массив-ассоциативный-вложенные-массивы-и-строки&#34; class=&#34;gblog-post__anchor clip flex align-center&#34; aria-label=&#34;Anchor 1. Массив ассоциативный: вложенные массивы и строки&#34; href=&#34;#1-%d0%bc%d0%b0%d1%81%d1%81%d0%b8%d0%b2-%d0%b0%d1%81%d1%81%d0%be%d1%86%d0%b8%d0%b0%d1%82%d0%b8%d0%b2%d0%bd%d1%8b%d0%b9-%d0%b2%d0%bb%d0%be%d0%b6%d0%b5%d0%bd%d0%bd%d1%8b%d0%b5-%d0%bc%d0%b0%d1%81%d1%81%d0%b8%d0%b2%d1%8b-%d0%b8-%d1%81%d1%82%d1%80%d0%be%d0%ba%d0%b8&#34;&gt;
        &lt;svg class=&#34;gblog-icon gblog_link&#34;&gt;&lt;use xlink:href=&#34;#gblog_link&#34;&gt;&lt;/use&gt;&lt;/svg&gt;
    &lt;/a&gt;
&lt;/div&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-php&#34; data-lang=&#34;php&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;array&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;s1&#34;&gt;&amp;#39;v0&amp;#39;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;array&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;mi&#34;&gt;23&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;23&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;mi&#34;&gt;24&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;24&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;s1&#34;&gt;&amp;#39;rnd0&amp;#39;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;2e0c883df6e2cb771103f4409f053549094d6787&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;c 16384 элементами&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;&lt;/th&gt;
          &lt;th style=&#34;text-align: center&#34;&gt;Время сериализации (msec)&lt;/th&gt;
          &lt;th style=&#34;text-align: center&#34;&gt;Время десериализации (msec)&lt;/th&gt;
          &lt;th style=&#34;text-align: center&#34;&gt;Размер упакованных данных (Kb)&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;MessagePack&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;9&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;25&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;678&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;igbinary&lt;br&gt;compact_strings=Off&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;9&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;32&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;1278&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;igbinary&lt;br&gt;compact_strings=On&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;16&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;32&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;1120&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;JSON&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;14&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;318&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;1022&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;SERIALIZE&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;62&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;39&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;2486&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;div class=&#34;flex align-center gblog-post__anchorwrap&#34;&gt;
    &lt;h3 id=&#34;2-массив-числовой-большие-массивы-целых-чисел&#34;
    &gt;
        2. Массив числовой: большие массивы целых чисел
    &lt;/h3&gt;
    &lt;a data-clipboard-text=&#34;https://valmat.ru/posts/archive/2013/12/serialize-php/#2-массив-числовой-большие-массивы-целых-чисел&#34; class=&#34;gblog-post__anchor clip flex align-center&#34; aria-label=&#34;Anchor 2. Массив числовой: большие массивы целых чисел&#34; href=&#34;#2-%d0%bc%d0%b0%d1%81%d1%81%d0%b8%d0%b2-%d1%87%d0%b8%d1%81%d0%bb%d0%be%d0%b2%d0%be%d0%b9-%d0%b1%d0%be%d0%bb%d1%8c%d1%88%d0%b8%d0%b5-%d0%bc%d0%b0%d1%81%d1%81%d0%b8%d0%b2%d1%8b-%d1%86%d0%b5%d0%bb%d1%8b%d1%85-%d1%87%d0%b8%d1%81%d0%b5%d0%bb&#34;&gt;
        &lt;svg class=&#34;gblog-icon gblog_link&#34;&gt;&lt;use xlink:href=&#34;#gblog_link&#34;&gt;&lt;/use&gt;&lt;/svg&gt;
    &lt;/a&gt;
&lt;/div&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-php&#34; data-lang=&#34;php&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;array&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;3183&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4527&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4084&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4032&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;3920&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;mi&#34;&gt;262144&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4455&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;&lt;/th&gt;
          &lt;th style=&#34;text-align: center&#34;&gt;Время сериализации (msec)&lt;/th&gt;
          &lt;th style=&#34;text-align: center&#34;&gt;Время десериализации (msec)&lt;/th&gt;
          &lt;th style=&#34;text-align: center&#34;&gt;Размер упакованных данных (Kb)&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;MessagePack&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;8&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;30&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;769&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;igbinary&lt;br&gt;compact_strings=Off&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;9&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;33&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;1920&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;igbinary&lt;br&gt;compact_strings=On&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;9&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;33&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;1920&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;JSON&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;15&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;107&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;1281&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;SERIALIZE&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;86&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;44&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;3988&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;div class=&#34;flex align-center gblog-post__anchorwrap&#34;&gt;
    &lt;h3 id=&#34;3-массив-числовой-большие-массивы-длинных-целых-чисел-int64&#34;
    &gt;
        3. Массив числовой: большие массивы длинных целых чисел (int64)
    &lt;/h3&gt;
    &lt;a data-clipboard-text=&#34;https://valmat.ru/posts/archive/2013/12/serialize-php/#3-массив-числовой-большие-массивы-длинных-целых-чисел-int64&#34; class=&#34;gblog-post__anchor clip flex align-center&#34; aria-label=&#34;Anchor 3. Массив числовой: большие массивы длинных целых чисел (int64)&#34; href=&#34;#3-%d0%bc%d0%b0%d1%81%d1%81%d0%b8%d0%b2-%d1%87%d0%b8%d1%81%d0%bb%d0%be%d0%b2%d0%be%d0%b9-%d0%b1%d0%be%d0%bb%d1%8c%d1%88%d0%b8%d0%b5-%d0%bc%d0%b0%d1%81%d1%81%d0%b8%d0%b2%d1%8b-%d0%b4%d0%bb%d0%b8%d0%bd%d0%bd%d1%8b%d1%85-%d1%86%d0%b5%d0%bb%d1%8b%d1%85-%d1%87%d0%b8%d1%81%d0%b5%d0%bb-int64&#34;&gt;
        &lt;svg class=&#34;gblog-icon gblog_link&#34;&gt;&lt;use xlink:href=&#34;#gblog_link&#34;&gt;&lt;/use&gt;&lt;/svg&gt;
    &lt;/a&gt;
&lt;/div&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-php&#34; data-lang=&#34;php&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;array&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;7679461759223599104&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4898705982311625344&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;5880628818820227328&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;mi&#34;&gt;262144&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;6940876209816891904&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;&lt;/th&gt;
          &lt;th style=&#34;text-align: center&#34;&gt;Время сериализации (msec)&lt;/th&gt;
          &lt;th style=&#34;text-align: center&#34;&gt;Время десериализации (msec)&lt;/th&gt;
          &lt;th style=&#34;text-align: center&#34;&gt;Размер упакованных данных (Kb)&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;MessagePack&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;10&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;29&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;2305&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;igbinary&lt;br&gt;compact_strings=Off&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;11&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;33&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;3456&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;igbinary&lt;br&gt;compact_strings=On&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;11&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;33&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;3456&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;JSON&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;20&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;172&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;5121&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;SERIALIZE&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;92&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;49&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;7828&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;div class=&#34;flex align-center gblog-post__anchorwrap&#34;&gt;
    &lt;h3 id=&#34;4-массив-числовой-большие-массивы-чисел-с-плавающей-точкой-float&#34;
    &gt;
        4. Массив числовой: большие массивы чисел с плавающей точкой (float)
    &lt;/h3&gt;
    &lt;a data-clipboard-text=&#34;https://valmat.ru/posts/archive/2013/12/serialize-php/#4-массив-числовой-большие-массивы-чисел-с-плавающей-точкой-float&#34; class=&#34;gblog-post__anchor clip flex align-center&#34; aria-label=&#34;Anchor 4. Массив числовой: большие массивы чисел с плавающей точкой (float)&#34; href=&#34;#4-%d0%bc%d0%b0%d1%81%d1%81%d0%b8%d0%b2-%d1%87%d0%b8%d1%81%d0%bb%d0%be%d0%b2%d0%be%d0%b9-%d0%b1%d0%be%d0%bb%d1%8c%d1%88%d0%b8%d0%b5-%d0%bc%d0%b0%d1%81%d1%81%d0%b8%d0%b2%d1%8b-%d1%87%d0%b8%d1%81%d0%b5%d0%bb-%d1%81-%d0%bf%d0%bb%d0%b0%d0%b2%d0%b0%d1%8e%d1%89%d0%b5%d0%b9-%d1%82%d0%be%d1%87%d0%ba%d0%be%d0%b9-float&#34;&gt;
        &lt;svg class=&#34;gblog-icon gblog_link&#34;&gt;&lt;use xlink:href=&#34;#gblog_link&#34;&gt;&lt;/use&gt;&lt;/svg&gt;
    &lt;/a&gt;
&lt;/div&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-php&#34; data-lang=&#34;php&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;array&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;0.00038631346578366&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;0.00016131634134538&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;0.00043595779928503&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;0.00011754334410814&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;0.00049353469548909&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;5.2391680201184E-5&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;mi&#34;&gt;262144&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;0.00041876046901173&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;&lt;/th&gt;
          &lt;th style=&#34;text-align: center&#34;&gt;Время сериализации (msec)&lt;/th&gt;
          &lt;th style=&#34;text-align: center&#34;&gt;Время десериализации (msec)&lt;/th&gt;
          &lt;th style=&#34;text-align: center&#34;&gt;Размер упакованных данных (Kb)&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;MessagePack&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;9&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;28&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;2305&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;igbinary&lt;br&gt;compact_strings=Off&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;11&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;33&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;3456&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;igbinary&lt;br&gt;compact_strings=On&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;11&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;33&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;3456&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;JSON&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;75&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;197&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;5061&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;SERIALIZE&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;264&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;176&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;8538&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;div class=&#34;flex align-center gblog-post__anchorwrap&#34;&gt;
    &lt;h3 id=&#34;5-массив-строковый-большие-массивы-длинных-строк&#34;
    &gt;
        5. Массив строковый: большие массивы длинных строк
    &lt;/h3&gt;
    &lt;a data-clipboard-text=&#34;https://valmat.ru/posts/archive/2013/12/serialize-php/#5-массив-строковый-большие-массивы-длинных-строк&#34; class=&#34;gblog-post__anchor clip flex align-center&#34; aria-label=&#34;Anchor 5. Массив строковый: большие массивы длинных строк&#34; href=&#34;#5-%d0%bc%d0%b0%d1%81%d1%81%d0%b8%d0%b2-%d1%81%d1%82%d1%80%d0%be%d0%ba%d0%be%d0%b2%d1%8b%d0%b9-%d0%b1%d0%be%d0%bb%d1%8c%d1%88%d0%b8%d0%b5-%d0%bc%d0%b0%d1%81%d1%81%d0%b8%d0%b2%d1%8b-%d0%b4%d0%bb%d0%b8%d0%bd%d0%bd%d1%8b%d1%85-%d1%81%d1%82%d1%80%d0%be%d0%ba&#34;&gt;
        &lt;svg class=&#34;gblog-icon gblog_link&#34;&gt;&lt;use xlink:href=&#34;#gblog_link&#34;&gt;&lt;/use&gt;&lt;/svg&gt;
    &lt;/a&gt;
&lt;/div&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-php&#34; data-lang=&#34;php&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;array&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;f7df8cb47630b8cd7eb73d0da7a23b9c01aaaa84f718499c1c8cef6730f9fd03c8125cab&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;d30f79cf7fef47bd7a5611719f936539bec0d2e93bcf6eecb2611212e088d0d91f2ade9c&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;86bce22a4d2805649853ac7909c4efb4dd18f255086af6e4641abb18caafc151b9aa95c8&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;63afd0edc0371ad842d7a7ecc76260be4bc3e8c0da6cb383f8f9e58f2c8af88a8c0eb65e&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;13c80015875a668e8fc059517ffd124abbda63c12d95666e2649fcfc6e3af75e09f5adb9&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;mi&#34;&gt;32768&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;0e3808238b738aafc13a2a62f36d2a49dec4e191c22abfa379f38b5b0411bc11fa9bf92f&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;&lt;/th&gt;
          &lt;th style=&#34;text-align: center&#34;&gt;Время сериализации (msec)&lt;/th&gt;
          &lt;th style=&#34;text-align: center&#34;&gt;Время десериализации (msec)&lt;/th&gt;
          &lt;th style=&#34;text-align: center&#34;&gt;Размер упакованных данных (Kb)&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;MessagePack&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;4&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;5&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;2401&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;igbinary&lt;br&gt;compact_strings=Off&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;4&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;6&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;2464&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;igbinary&lt;br&gt;compact_strings=On&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;21&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;6&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;2463&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;JSON&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;28&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;16&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;2401&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;SERIALIZE&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;10&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;7&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;2806&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;p&gt;Замечу, что приведенные в таблицах данные являются примерными и зависят от данных. Так как данные у меня заполнялись случайным образом, то цифры получались разные, но разница несущественна и в целом эти цифры отражают реальную картину.&lt;/p&gt;

            </content>    
                                <category scheme="https://valmat.ru/tags/archive" term="archive" label="archive" />
        </entry>
        <entry>
            <title>Разжился SSD диском</title>
            <link href="https://valmat.ru/posts/archive/2013/12/ssd/" rel="alternate" type="text/html"  hreflang="en" />
            <id>https://valmat.ru/posts/archive/2013/12/ssd/</id>
            <published>2013-12-02T11:55:00+00:00</published>
            <updated>2013-12-02T11:55:00+00:00</updated>
            <content type="html">
                &lt;p&gt;Вот и я разжился SSD диском.&lt;/p&gt;
&lt;!-- ![SSD диск](./02.12.13+-+1) --&gt;
&lt;p&gt;Будет на чем тестить NoSQL SSD хранилища.&lt;/p&gt;
&lt;p&gt;В планах потестить на нем RocksDB, LevelDB и, возможно, RethinkDB.&lt;/p&gt;
&lt;!-- PS: а вот так он встал в мой ноут

![SSD в ноутбуке](./02.12.13+-+2)
 --&gt;
            </content>    
                                <category scheme="https://valmat.ru/tags/archive" term="archive" label="archive" />
        </entry>
        <entry>
            <title>Пластилиновый мультик</title>
            <link href="https://valmat.ru/posts/archive/2013/03/plastylynovyy-multik/" rel="alternate" type="text/html"  hreflang="en" />
            <id>https://valmat.ru/posts/archive/2013/03/plastylynovyy-multik/</id>
            <published>2013-03-04T08:50:00+00:00</published>
            <updated>2013-03-04T08:50:00+00:00</updated>
            <content type="html">
                &lt;p&gt;Сделали с дочей мультик из пластилина.&lt;/p&gt;
&lt;p&gt;Делается так:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;convert -delay &lt;span class=&#34;m&#34;&gt;20&lt;/span&gt; -loop &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; *.jpg mygif.gif
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Вот результат:&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;./myimage.gif&#34;
  alt=&#34;Пластилиновый мультик&#34;
  
/&gt;&lt;/p&gt;
&lt;p&gt;Еще полезное:&lt;/p&gt;
&lt;p&gt;Сделать из кадров ролик:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;convert -delay &lt;span class=&#34;m&#34;&gt;20&lt;/span&gt; -loop &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; *.jpg mympg.mpg
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;MOV из gif:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;convert mygif.gif mymov.mov
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Видео на YouTube:&lt;/p&gt;
&lt;iframe width=&#34;320&#34; height=&#34;266&#34; src=&#34;https://www.youtube.com/embed/_oHiKSMMwAA&#34; title=&#34;Пластелиновый человечик&#34; frameborder=&#34;0&#34; allow=&#34;accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share&#34; referrerpolicy=&#34;strict-origin-when-cross-origin&#34; allowfullscreen&gt;&lt;/iframe&gt;
&lt;p&gt;&lt;a
  class=&#34;gblog-markdown__link&#34;
  href=&#34;https://www.youtube.com/watch?v=_oHiKSMMwAA&#34;
&gt;Смотреть на YouTube&lt;/a&gt;&lt;/p&gt;

            </content>    
                                <category scheme="https://valmat.ru/tags/archive" term="archive" label="archive" />
        </entry>
        <entry>
            <title>Топ 7 ботов за сутки</title>
            <link href="https://valmat.ru/posts/archive/2013/03/top7bots/" rel="alternate" type="text/html"  hreflang="en" />
            <id>https://valmat.ru/posts/archive/2013/03/top7bots/</id>
            <published>2013-03-01T09:32:00+00:00</published>
            <updated>2013-03-01T09:32:00+00:00</updated>
            <content type="html">
                &lt;p&gt;По результатам выборки из логов сервера за 1 сутки.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;Googlebot&lt;/strong&gt; — 43 229 запросов&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;YandexDirect&lt;/strong&gt; — 21 260&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Mediapartners-Google&lt;/strong&gt; — 14 386&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Mail.RU_Bot&lt;/strong&gt; — 13 715&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;YandexBot&lt;/strong&gt; — 13 079&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;AhrefsBot&lt;/strong&gt; — 11 997&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;openstat ru/Bot&lt;/strong&gt; — 2 709&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;Выводы:&lt;/strong&gt;&lt;br&gt;
Гугл предсказуемо обошёл всех и вся. Честь и хвала ему.&lt;br&gt;
Удивил Mail.RU, который обошёл Яндекс.&lt;br&gt;
Что касается Яндекса, то очевидно, что приоритет Яндекса — их рекламная сеть. И уже потом поисковые технологии.&lt;/p&gt;
&lt;p&gt;Можно сравнить, какое значение Гугл и Яндекс уделяют своим поисковым и рекламным технологиям в процентном соотношении:&lt;/p&gt;
&lt;p&gt;&lt;em&gt;YandexDirect&lt;/em&gt; — &lt;strong&gt;62%&lt;/strong&gt;&lt;br&gt;
&lt;em&gt;YandexBot&lt;/em&gt; — &lt;strong&gt;38%&lt;/strong&gt;&lt;br&gt;
&lt;em&gt;Mediapartners-Google&lt;/em&gt; — &lt;strong&gt;25%&lt;/strong&gt;&lt;br&gt;
&lt;em&gt;Googlebot&lt;/em&gt; — &lt;strong&gt;75%&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Далее AhrefsBot — собиратель беклинков. Бесполезная (а иногда и вредная) нагрузка на сервер. Вредная потому, что конкуренты смогут видеть то, что им видеть не положено. Его блочим в &lt;code&gt;robots.txt&lt;/code&gt;.&lt;br&gt;
Поскольку есть сомнения, что он вообще читает &lt;code&gt;robots.txt&lt;/code&gt;, то для профилактики делаем примерно так:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-nginx&#34; data-lang=&#34;nginx&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$http_user_agent&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;~&lt;/span&gt;&lt;span class=&#34;sr&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;(Wget|ApacheBench|SISTRIX|AhrefsBot|Teleport)&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kn&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;502&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Ну и Bot openstat, я считаю, вообще недостоин нашего внимания.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;PS. Чуть не забыл.&lt;/strong&gt;&lt;br&gt;
Получить Top список IP-адресов можно так:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cat ваши_лог_фалы &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; cut -c -15 &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; sort &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; uniq -c &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; sort -nr &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; sed -r &lt;span class=&#34;s1&#34;&gt;&amp;#39;s!\s*([0-9]+)\s+([0-9]+\.[0-9]+\.[0-9]+\.[0-9]+).*!\1\t\2!g&amp;#39;&lt;/span&gt; &amp;gt; top.log
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;А выборку по отдельным ботам можно получить &lt;code&gt;grep&lt;/code&gt;&amp;lsquo;ом.&lt;/p&gt;

            </content>    
                                <category scheme="https://valmat.ru/tags/archive" term="archive" label="archive" />
        </entry>
        <entry>
            <title>Google Chrome и &#34;-&#34; 400 0 &#34;-&#34; &#34;-&#34;</title>
            <link href="https://valmat.ru/posts/archive/2013/01/chrome-400-log/" rel="alternate" type="text/html"  hreflang="en" />
            <id>https://valmat.ru/posts/archive/2013/01/chrome-400-log/</id>
            <published>2013-01-24T20:46:00+00:00</published>
            <updated>2013-01-24T20:46:00+00:00</updated>
            <content type="html">
                &lt;p&gt;Еще раз к вопросу &lt;a
  class=&#34;gblog-markdown__link&#34;
  href=&#34;http://www.valmat.ru/2013/01/ban-bot-2.html&#34;
&gt;откуда в логах берутся строки вида&lt;/a&gt;:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;1.1.1.1 - - [19/Jan/2013:07:19:23 +0400] &amp;#34;-&amp;#34; 400 0 &amp;#34;-&amp;#34; &amp;#34;-&amp;#34;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;При медленном соединении удалось отловить эффект появления таких записей в браузере и увидеть все вживую.&lt;/p&gt;
&lt;p&gt;Вот тут видно, как Chrome отправил два запроса, держит соединение открытым, а потом закрывает:&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;./404-chrome.png&#34;
  alt=&#34;chrome-400&#34;
  
/&gt;&lt;/p&gt;
&lt;p&gt;А секундой позже уже загружает то, что его просили.&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;./404-chrome-1.png&#34;
  alt=&#34;chrome-400-1&#34;
  
/&gt;&lt;/p&gt;
&lt;p&gt;Успел сделать снимки экрана.&lt;/p&gt;
&lt;p&gt;Повторить эксперимент можно либо подключившись к медленному каналу, либо намеренно ограничив скорость соединения на стороне веб-сервера.&lt;/p&gt;

            </content>    
                                <category scheme="https://valmat.ru/tags/archive" term="archive" label="archive" />
        </entry>
        <entry>
            <title>Баним ботов. Часть 2</title>
            <link href="https://valmat.ru/posts/archive/2013/01/ban-bot-2/" rel="alternate" type="text/html"  hreflang="en" />
            <id>https://valmat.ru/posts/archive/2013/01/ban-bot-2/</id>
            <published>2013-01-23T14:21:00+00:00</published>
            <updated>2013-01-23T14:21:00+00:00</updated>
            <content type="html">
                &lt;p&gt;Небольшой анализ логов сервера. Какие странные сущности обитают в Интернете. И как с ними бороться.&lt;/p&gt;
&lt;div class=&#34;flex align-center gblog-post__anchorwrap&#34;&gt;
    &lt;h3 id=&#34;открытые-подключения&#34;
    &gt;
        Открытые подключения
    &lt;/h3&gt;
    &lt;a data-clipboard-text=&#34;https://valmat.ru/posts/archive/2013/01/ban-bot-2/#открытые-подключения&#34; class=&#34;gblog-post__anchor clip flex align-center&#34; aria-label=&#34;Anchor Открытые подключения&#34; href=&#34;#%d0%be%d1%82%d0%ba%d1%80%d1%8b%d1%82%d1%8b%d0%b5-%d0%bf%d0%be%d0%b4%d0%ba%d0%bb%d1%8e%d1%87%d0%b5%d0%bd%d0%b8%d1%8f&#34;&gt;
        &lt;svg class=&#34;gblog-icon gblog_link&#34;&gt;&lt;use xlink:href=&#34;#gblog_link&#34;&gt;&lt;/use&gt;&lt;/svg&gt;
    &lt;/a&gt;
&lt;/div&gt;
&lt;p&gt;В логах nginx&amp;rsquo;а обнаружил десятки тысяч записей вида:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;1.1.1.1 - - [19/Jan/2013:07:19:23 +0400] &amp;#34;-&amp;#34; 400 0 &amp;#34;-&amp;#34; &amp;#34;-&amp;#34;
1.1.1.1 - - [19/Jan/2013:07:19:23 +0400] &amp;#34;-&amp;#34; 400 0 &amp;#34;-&amp;#34; &amp;#34;-&amp;#34;
1.1.1.1 - - [19/Jan/2013:07:19:23 +0400] &amp;#34;-&amp;#34; 400 0 &amp;#34;-&amp;#34; &amp;#34;-&amp;#34;
1.1.1.1 - - [19/Jan/2013:07:19:34 +0400] &amp;#34;-&amp;#34; 400 0 &amp;#34;-&amp;#34; &amp;#34;-&amp;#34;
1.1.1.1 - - [19/Jan/2013:07:19:34 +0400] &amp;#34;-&amp;#34; 400 0 &amp;#34;-&amp;#34; &amp;#34;-&amp;#34;
1.1.1.1 - - [19/Jan/2013:07:19:34 +0400] &amp;#34;-&amp;#34; 400 0 &amp;#34;-&amp;#34; &amp;#34;-&amp;#34;
1.1.1.1 - - [19/Jan/2013:07:19:34 +0400] &amp;#34;-&amp;#34; 400 0 &amp;#34;-&amp;#34; &amp;#34;-&amp;#34;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Судя по количеству и частоте запросов, достаточно большое число таких запросов сделано именно ботами.&lt;/p&gt;
&lt;p&gt;Казалось бы, легко создать правило для fail2ban и забанить их всех.&lt;/p&gt;
&lt;p&gt;Но такие записи могут создавать и обычные пользователи. Например, если пользователь остановит загрузку или при быстром переходе со страницы на страницу (у меня получилось &lt;a
  class=&#34;gblog-markdown__link&#34;
  href=&#34;http://www.valmat.ru/2013/01/-400-0-.html&#34;
&gt;отловить такой эффект в Google Chrome&lt;/a&gt;).&lt;/p&gt;
&lt;p&gt;Суть таких записей такова: открытое и не закрытое соединение.&lt;/p&gt;
&lt;p&gt;Например, если открыть соединение telnet&amp;rsquo;ом и оставить его, то по истечении таймаута появится именно такая запись.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;$ telnet site.ru 80&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Trying 127.0.0.1...
Connected to site.ru.
Escape character is &amp;#39;^]&amp;#39;.
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Или можно так:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-php&#34; data-lang=&#34;php&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;php&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;for($i=0;$i&amp;gt;500;$i++){$v=&amp;#34;s&amp;#34;.$i;$$v=socket_create(AF_INET,SOCK_STREAM,SOL_TCP);socket_connect($$v,&amp;#34;localhost&amp;#34;, 80);}&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Особого вреда такие атаки нанести не могут, т.к. в силу своего асинхронного характера nginx может держать &lt;a
  class=&#34;gblog-markdown__link&#34;
  href=&#34;http://forum.nginx.org/read.php?21,129983,129986#msg-129986&#34;
&gt;достаточно&lt;/a&gt; &lt;a
  class=&#34;gblog-markdown__link&#34;
  href=&#34;http://nginx.org/ru/docs/ngx_core_module.html#worker_connections&#34;
&gt;большое&lt;/a&gt; число открытых соединений. Но специально для таких случаев (а также других недоатак) существуют такие вещи, как модули &lt;a
  class=&#34;gblog-markdown__link&#34;
  href=&#34;http://nginx.org/ru/docs/http/ngx_http_limit_req_module.html&#34;
&gt;ngx_http_limit_req_module&lt;/a&gt; и &lt;a
  class=&#34;gblog-markdown__link&#34;
  href=&#34;http://nginx.org/ru/docs/http/ngx_http_limit_conn_module.html&#34;
&gt;ngx_http_limit_conn_module&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Про них написано достаточно много, простым гуглением все находится.&lt;/p&gt;
&lt;p&gt;Можно только добавить — не забыть вставить в robots.txt строчку вроде этой:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Crawl-delay: 1
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;(можно дробные значения), чтобы ненароком не забанить поисковых роботов.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;limit_req_zone&lt;/code&gt; должна обязательно стоять (в секции http) до подключения секций server, т.е. до&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;include /etc/nginx/conf.d/*.conf;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Еще некоторых ленивых роботов, передающих не все заголовки, можно развернуть вот таким кодом в секции server:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-nginx&#34; data-lang=&#34;nginx&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;(&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$http_user_agent&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kn&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;444&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;flex align-center gblog-post__anchorwrap&#34;&gt;
    &lt;h3 id=&#34;try-proxy&#34;
    &gt;
        try proxy
    &lt;/h3&gt;
    &lt;a data-clipboard-text=&#34;https://valmat.ru/posts/archive/2013/01/ban-bot-2/#try-proxy&#34; class=&#34;gblog-post__anchor clip flex align-center&#34; aria-label=&#34;Anchor try proxy&#34; href=&#34;#try-proxy&#34;&gt;
        &lt;svg class=&#34;gblog-icon gblog_link&#34;&gt;&lt;use xlink:href=&#34;#gblog_link&#34;&gt;&lt;/use&gt;&lt;/svg&gt;
    &lt;/a&gt;
&lt;/div&gt;
&lt;p&gt;Следующая разновидность ботов пытается использовать nginx в качестве открытого прокси-сервера. Точнее, пытается определить такую возможность.&lt;/p&gt;
&lt;p&gt;Дело в том, что если, например, telnet&amp;rsquo;ом передать заголовок не&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;GET /index.htm HTTP/1.1
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;а&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;GET http://site.ru/index.htm
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;то nginx не разворачивает такой запрос с кодом 400, а обрабатывает его.&lt;/p&gt;
&lt;p&gt;И дальше все зависит от настройки конфигов.&lt;/p&gt;
&lt;p&gt;В некоторых случаях, таким образом можно получить &lt;a
  class=&#34;gblog-markdown__link&#34;
  href=&#34;http://forum.nginx.org/read.php?21,226769,227097#msg-227097&#34;
&gt;открытый http-прокси сервер&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;В общем случае, если site.ru определён в nginx как&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;server_name site.ru;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;то дальше вашего сервера запрос не уйдет.&lt;/p&gt;
&lt;p&gt;Вот реальный пример из log-файла:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;178.77.67.27 - - [20/Jan/2013:19:09:43 +0400] &amp;#34;GET http://www.scanproxy.net:80/p-80.html HTTP/1.0&amp;#34; 404 564 &amp;#34;-&amp;#34; &amp;#34;Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; KuKu 0.65)&amp;#34;
82.145.35.123 - - [10/Jan/2013:08:11:20 +0400] &amp;#34;GET http://proxyjudge2.proxyfire.net/fastenv HTTP/1.1&amp;#34; 404 564 &amp;#34;-&amp;#34; &amp;#34;Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Trident/5.0)&amp;#34;
80.82.215.45 - - [01/Jan/2013:08:59:03 +0400] &amp;#34;GET http://www.scanproxy.net:80/p-80.html HTTP/1.0&amp;#34; 404 564 &amp;#34;-&amp;#34; &amp;#34;Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; KuKu 0.65)&amp;#34;
62.193.243.32 - - [01/Jan/2013:23:38:53 +0400] &amp;#34;GET http://www.scanproxy.net:80/p-80.html HTTP/1.0&amp;#34; 404 564 &amp;#34;-&amp;#34; &amp;#34;Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; KuKu 0.65)&amp;#34;
46.32.65.23 - - [11/Dec/2012:19:20:15 +0400] &amp;#34;GET http://www.santeh.ru/cgi-bin/textenv.pl HTTP/1.0&amp;#34; 404 564 &amp;#34;-&amp;#34; &amp;#34;Mozilla/4.0 (compatible; MSIE 5.5; Windows NT 4.0)&amp;#34;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;В основном, лечится это так: запретить использование дефолтного сервера и обработку запросов &lt;a
  class=&#34;gblog-markdown__link&#34;
  href=&#34;http://nginx.org/ru/docs/http/request_processing.html#how_to_prevent_undefined_server_names&#34;
&gt;без имени сервера&lt;/a&gt;.&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;server {
    listen      80 default_server;
    server_name &amp;#34;&amp;#34;;
    return      444;
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Далее, при передаче заголовка (без HTTP/1.1 или HTTP/1.0):&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;GET http://site.ru/index.htm
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Все остальные строки запроса будут проигнорированы.&lt;/p&gt;
&lt;p&gt;Т.е. в запросе (вместо &lt;code&gt;GET /index.htm HTTP/1.1&lt;/code&gt; написано &lt;code&gt;GET http://site.ru/index.htm&lt;/code&gt;):&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;GET http://site.ru/index.htm
Accept:text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Charset:windows-1251,utf-8;q=0.7,*;q=0.3
Accept-Language:ru-RU,ru;q=0.8,en-US;q=0.6,en;q=0.4
Cache-Control:max-age=0
Connection:keep-alive
Host:site.ru
Referer:site.ru/index.htm
User-Agent:TelnetTester
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Будет учтена только первая строка. А значит, поможет уже знакомая нам конструкция:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-nginx&#34; data-lang=&#34;nginx&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;(&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$http_user_agent&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kn&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;444&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Но такая ситуация встречается не часто.&lt;/p&gt;
&lt;p&gt;Кроме ботов, запросы вида &lt;code&gt;GET http://site.ru/index.htm HTTP/1.1&lt;/code&gt; шлет Opera. Во всяком случае, у меня в логах достаточно много строк вроде этой:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;188.162.15.86 - - [05/Jan/2013:09:18:41 +0400] &amp;#34;GET http://opera10beta-turbo.opera-mini.net:80//img/spb_b_1456.jpg HTTP/1.1&amp;#34; 404 162 &amp;#34;http://images.yandex.ru/yandsearch?p=...&amp;#34; &amp;#34;Opera/9.80 (Windows NT 5.1) Presto/2.12.388 Version/12.10&amp;#34;
&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;flex align-center gblog-post__anchorwrap&#34;&gt;
    &lt;h4 id=&#34;битые-заголовки&#34;
    &gt;
        Битые заголовки
    &lt;/h4&gt;
    &lt;a data-clipboard-text=&#34;https://valmat.ru/posts/archive/2013/01/ban-bot-2/#битые-заголовки&#34; class=&#34;gblog-post__anchor clip flex align-center&#34; aria-label=&#34;Anchor Битые заголовки&#34; href=&#34;#%d0%b1%d0%b8%d1%82%d1%8b%d0%b5-%d0%b7%d0%b0%d0%b3%d0%be%d0%bb%d0%be%d0%b2%d0%ba%d0%b8&#34;&gt;
        &lt;svg class=&#34;gblog-icon gblog_link&#34;&gt;&lt;use xlink:href=&#34;#gblog_link&#34;&gt;&lt;/use&gt;&lt;/svg&gt;
    &lt;/a&gt;
&lt;/div&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;94.41.37.135 - - [11/Jan/2013:08:51:57 +0400] &amp;#34;ЪьЪЮ\x00\x10JFIF\x00\x01\x01\x00\x00\x01\x00\x01\x00\x00ЪЧ\x00;CREATOR: gd-jpeg v1.0 (using IJG JPEG v62), quality = 75&amp;#34; 400 166 &amp;#34;-&amp;#34; &amp;#34;-&amp;#34;
176.213.180.115 - - [07/Jan/2013:16:27:16 +0400] &amp;#34;ЪьЪЮ\x00\x10JFIF\x00\x01\x01\x01\x00`\x00`\x00\x00Ъш\x00C\x00\x02\x01\x01\x02\x01\x01\x02\x02\x02\x02\x02\x02\x02\x02\x03\x05\x03\x03\x03\x03\x03\x06\x04\x04\x03\x05\x07\x06\x07\x07\x07\x06\x07\x07\x08\x09\x0B\x09\x08\x08&amp;#34; 400 166 &amp;#34;-&amp;#34; &amp;#34;-&amp;#34;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Такие строки создают некоторые браузеры. Как это происходит — я так и не понял. Но нечто подобное я нашел в логах на локальной машине — там, где никаких ботов быть не может. Предположительно, Google Chrome.&lt;/p&gt;
&lt;p&gt;Также весьма вероятно, подобные записи могут создаваться некоторыми ботами, ищущими уязвимости веб-сервера.&lt;/p&gt;
&lt;p&gt;Вот, например, &lt;a
  class=&#34;gblog-markdown__link&#34;
  href=&#34;http://disorder.ru/archives/908&#34;
&gt;http://disorder.ru/archives/908&lt;/a&gt; — человек описал эксплоит для старых версий Nginx, а вот это:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;188.138.88.171 - - [19/Jan/2013:20:05:45 +0400] &amp;#34;GET /w00tw00t.at.ISC.SANS.DFind:) HTTP/1.1&amp;#34; 400 166 &amp;#34;-&amp;#34; &amp;#34;-&amp;#34;

50.63.136.60 - - [19/Jan/2013:20:32:27 +0400] &amp;#34;GET /w00tw00t.at.ISC.SANS.Win32:) HTTP/1.1&amp;#34; 400 166 &amp;#34;-&amp;#34; &amp;#34;-&amp;#34;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;явно адресовано IIS.&lt;/p&gt;
&lt;p&gt;Такие записи просто можно игнорировать. В случае особой настойчивости помогает способ с &lt;code&gt;ngx_http_limit_req_module&lt;/code&gt;, описанный в предыдущем пункте.&lt;/p&gt;

            </content>    
                                <category scheme="https://valmat.ru/tags/archive" term="archive" label="archive" />
        </entry>
        <entry>
            <title>Баним ботов. Часть 1</title>
            <link href="https://valmat.ru/posts/archive/2013/01/pma-bot-ban/" rel="alternate" type="text/html"  hreflang="en" />
            <id>https://valmat.ru/posts/archive/2013/01/pma-bot-ban/</id>
            <published>2013-01-20T11:07:00+00:00</published>
            <updated>2013-01-20T11:07:00+00:00</updated>
            <content type="html">
                &lt;p&gt;В один прекрасный день мне надоело видеть у себя в логах такое вот безобразие:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;113.204.67.51 - - [19/Jan/2013:07:22:08 +0400] &amp;#34;GET /phpmyadmin/ HTTP/1.1&amp;#34; 404 564 &amp;#34;-&amp;#34; &amp;#34;Mozilla/4.0 (compatible; MSIE 6.0; Windows 98)&amp;#34;
113.204.67.51 - - [19/Jan/2013:07:22:12 +0400] &amp;#34;GET /PMA/ HTTP/1.1&amp;#34; 404 564 &amp;#34;-&amp;#34; &amp;#34;Mozilla/4.0 (compatible; MSIE 6.0; Windows 98)&amp;#34;
113.204.67.51 - - [19/Jan/2013:07:22:17 +0400] &amp;#34;GET /pma/ HTTP/1.1&amp;#34; 404 564 &amp;#34;-&amp;#34; &amp;#34;Mozilla/4.0 (compatible; MSIE 6.0; Windows 98)&amp;#34;
113.204.67.51 - - [19/Jan/2013:07:22:17 +0400] &amp;#34;GET /admin/ HTTP/1.1&amp;#34; 404 564 &amp;#34;-&amp;#34; &amp;#34;Mozilla/4.0 (compatible; MSIE 6.0; Windows 98)&amp;#34;
113.204.67.51 - - [19/Jan/2013:07:22:18 +0400] &amp;#34;GET /dbadmin/ HTTP/1.1&amp;#34; 404 564 &amp;#34;-&amp;#34; &amp;#34;Mozilla/4.0 (compatible; MSIE 6.0; Windows 98)&amp;#34;
113.204.67.51 - - [19/Jan/2013:07:22:19 +0400] &amp;#34;GET /sql/ HTTP/1.1&amp;#34; 404 564 &amp;#34;-&amp;#34; &amp;#34;Mozilla/4.0 (compatible; MSIE 6.0; Windows 98)&amp;#34;
113.204.67.51 - - [19/Jan/2013:07:22:20 +0400] &amp;#34;GET /mysql/ HTTP/1.1&amp;#34; 404 564 &amp;#34;-&amp;#34; &amp;#34;Mozilla/4.0 (compatible; MSIE 6.0; Windows 98)&amp;#34;
113.204.67.51 - - [19/Jan/2013:07:22:20 +0400] &amp;#34;GET /myadmin/ HTTP/1.1&amp;#34; 404 564 &amp;#34;-&amp;#34; &amp;#34;Mozilla/4.0 (compatible; MSIE 6.0; Windows 98)&amp;#34;
113.204.67.51 - - [19/Jan/2013:07:22:21 +0400] &amp;#34;GET /phpmyadmin2/ HTTP/1.1&amp;#34; 404 564 &amp;#34;-&amp;#34; &amp;#34;Mozilla/4.0 (compatible; MSIE 6.0; Windows 98)&amp;#34;
113.204.67.51 - - [19/Jan/2013:07:22:22 +0400] &amp;#34;GET /phpMyAdmin2/ HTTP/1.1&amp;#34; 404 564 &amp;#34;-&amp;#34; &amp;#34;Mozilla/4.0 (compatible; MSIE 6.0; Windows 98)&amp;#34;
113.204.67.51 - - [19/Jan/2013:07:22:23 +0400] &amp;#34;GET /phpMyAdmin-2/ HTTP/1.1&amp;#34; 404 564 &amp;#34;-&amp;#34; &amp;#34;Mozilla/4.0 (compatible; MSIE 6.0; Windows 98)&amp;#34;
113.204.67.51 - - [19/Jan/2013:07:22:23 +0400] &amp;#34;GET /php-my-admin/ HTTP/1.1&amp;#34; 404 564 &amp;#34;-&amp;#34; &amp;#34;Mozilla/4.0 (compatible; MSIE 6.0; Windows 98)&amp;#34;
113.204.67.51 - - [19/Jan/2013:07:22:24 +0400] &amp;#34;GET /sqlmanager/ HTTP/1.1&amp;#34; 404 564 &amp;#34;-&amp;#34; &amp;#34;Mozilla/4.0 (compatible; MSIE 6.0; Windows 98)&amp;#34;
113.204.67.51 - - [19/Jan/2013:07:22:25 +0400] &amp;#34;GET /mysqlmanager/ HTTP/1.1&amp;#34; 404 564 &amp;#34;-&amp;#34; &amp;#34;Mozilla/4.0 (compatible; MSIE 6.0; Windows 98)&amp;#34;
113.204.67.51 - - [19/Jan/2013:07:22:26 +0400] &amp;#34;GET /p/m/a/ HTTP/1.1&amp;#34; 404 564 &amp;#34;-&amp;#34; &amp;#34;Mozilla/4.0 (compatible; MSIE 6.0; Windows 98)&amp;#34;
113.204.67.51 - - [19/Jan/2013:07:22:26 +0400] &amp;#34;GET /php-myadmin/ HTTP/1.1&amp;#34; 404 564 &amp;#34;-&amp;#34; &amp;#34;Mozilla/4.0 (compatible; MSIE 6.0; Windows 98)&amp;#34;
113.204.67.51 - - [19/Jan/2013:07:22:27 +0400] &amp;#34;GET /phpmy-admin/ HTTP/1.1&amp;#34; 404 564 &amp;#34;-&amp;#34; &amp;#34;Mozilla/4.0 (compatible; MSIE 6.0; Windows 98)&amp;#34;
113.204.67.51 - - [19/Jan/2013:07:22:28 +0400] &amp;#34;GET /webadmin/ HTTP/1.1&amp;#34; 404 564 &amp;#34;-&amp;#34; &amp;#34;Mozilla/4.0 (compatible; MSIE 6.0; Windows 98)&amp;#34;
113.204.67.51 - - [19/Jan/2013:07:22:29 +0400] &amp;#34;GET /sqlweb/ HTTP/1.1&amp;#34; 404 564 &amp;#34;-&amp;#34; &amp;#34;Mozilla/4.0 (compatible; MSIE 6.0; Windows 98)&amp;#34;
113.204.67.51 - - [19/Jan/2013:07:22:30 +0400] &amp;#34;GET /websql/ HTTP/1.1&amp;#34; 404 564 &amp;#34;-&amp;#34; &amp;#34;Mozilla/4.0 (compatible; MSIE 6.0; Windows 98)&amp;#34;
113.204.67.51 - - [19/Jan/2013:07:22:31 +0400] &amp;#34;GET /webdb/ HTTP/1.1&amp;#34; 404 564 &amp;#34;-&amp;#34; &amp;#34;Mozilla/4.0 (compatible; MSIE 6.0; Windows 98)&amp;#34;
113.204.67.51 - - [19/Jan/2013:07:22:31 +0400] &amp;#34;GET /mysqladmin/ HTTP/1.1&amp;#34; 404 564 &amp;#34;-&amp;#34; &amp;#34;Mozilla/4.0 (compatible; MSIE 6.0; Windows 98)&amp;#34;
113.204.67.51 - - [19/Jan/2013:07:22:32 +0400] &amp;#34;GET /mysql-admin/ HTTP/1.1&amp;#34; 404 564 &amp;#34;-&amp;#34; &amp;#34;Mozilla/4.0 (compatible; MSIE 6.0; Windows 98)&amp;#34;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;и решил я всех этих мерзких ботов забанить.&lt;/p&gt;
&lt;p&gt;Для чего был создан fail2ban-скрипт &lt;code&gt;phpmyadmin.conf&lt;/code&gt; следующего содержания:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;c1&#34;&gt;# Fail2Ban configuration file  &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;c1&#34;&gt;#  &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;c1&#34;&gt;# Author: Valmat  &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;c1&#34;&gt;#&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;Definition&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;nv&#34;&gt;failregex&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; ^&amp;lt;host&amp;gt; - - &lt;span class=&#34;se&#34;&gt;\[&lt;/span&gt;.*&lt;span class=&#34;se&#34;&gt;\]&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;GET /(phpmyadmin|PMA|pma|admin|dbadmin|sql|mysql|myadmin|phpmyadmin2|phpMyAdmin2|phpMyAdmin-2|php-my-admin|sqlmanager|mysqlmanager|p/m/a|php-myadmin|phpmy-admin|webadmin|sqlweb|websql|webdb|mysqladmin|mysql-admin)/ HTTP/1.1&amp;#34;&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;404&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;nv&#34;&gt;ignoreregex&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;В &lt;code&gt;/etc/fail2ban/jail.conf&lt;/code&gt; нужно добавить секцию:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;phpmyadmin&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;enabled&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;port&lt;/span&gt;    &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; http,https  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;filter&lt;/span&gt;  &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; phpmyadmin  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;logpath&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; /var/log/nginx/localhost.access.log  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;bantime&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;86400&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;maxretry&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;За основу для построения скрипта был взят список:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;phpmyadmin
PMA
pma
admin
dbadmin
sql
mysql
myadmin
phpmyadmin2
phpMyAdmin2
phpMyAdmin-2
php-my-admin
sqlmanager
mysqlmanager
p/m/a
php-myadmin
phpmy-admin
webadmin
sqlweb
websql
webdb
mysqladmin
mysql-admin
2phpmyadmin
MyAdmin
admin/db
admin/pMA
admin/phpMyAdmin
admin/phpmyadmin
admin/sqladmin
admin/sysadmin
admin/web
administrator/PMA
administrator/admin
administrator/db
administrator/phpMyAdmin
administrator/phpmyadmin
administrator/pma
administrator/web
database
db
mysql/admin
mysql/db
mysql/dbadmin
mysql/mysqlmanager
mysql/pMA
mysql/pma
mysql/sqlmanager
mysql/web
phpMyAdmin
phpMyadmin
phpmy
phpmyAdmin
phppma
program
sql/myadmin
sql/php-myadmin
sql/phpMyAdmin
sql/phpMyAdmin2
sql/phpmanager
sql/phpmy-admin
sql/phpmyadmin2
sql/sqladmin
sql/sqlweb
sql/webadmin
sql/webdb
sql/websql
PMA2005
pma2005
phpmanager
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Учитывая логику работы ботов, то что в первую очередь они простукивают каталоги первого уровня, а лишь затем уровнем выше, этот список можно сократить до такого:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;phpmyadmin
PMA
pma
admin
dbadmin
sql
mysql
myadmin
phpmyadmin2
phpMyAdmin2
phpMyAdmin-2
php-my-admin
sqlmanager
mysqlmanager
p/m/a
php-myadmin
phpmy-admin
webadmin
sqlweb
websql
webdb
mysqladmin
mysql-admin
2phpmyadmin
MyAdmin
PMA2005
administrator
database
db
phpMyAdmin
phpMyadmin
phpmanager
phpmy
phpmyAdmin
phppma
pma2005
program
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;В результате получается приведённый выше конфиг.&lt;/p&gt;
&lt;p&gt;Для проверки используем команду:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;fail2ban-regex &amp;#39;113.204.67.51 - - [19/Jan/2013:07:22:25 +0400] &amp;#34;GET /mysqlmanager/ HTTP/1.1&amp;#34; 404 564 &amp;#34;-&amp;#34; &amp;#34;Mozilla/4.0 (compatible; MSIE 6.0; Windows 98)&amp;#34;&amp;#39; &amp;#39;^&amp;lt;host&amp;gt; - - \[.*\] &amp;#34;GET /(phpmyadmin|PMA|pma|admin|dbadmin|sql|mysql|myadmin|phpmyadmin2|phpMyAdmin2|phpMyAdmin-2|php-my-admin|sqlmanager|mysqlmanager|p/m/a|php-myadmin|phpmy-admin|webadmin|sqlweb|websql|webdb|mysqladmin|mysql-admin|2phpmyadmin|MyAdmin|PMA2005|administrator|database|db|phpMyAdmin|phpMyadmin|phpmanager|phpmy|phpmyAdmin|phppma|pma2005|program)/ HTTP/1.1&amp;#34; 404&amp;#39;
&lt;/code&gt;&lt;/pre&gt;
            </content>    
                                <category scheme="https://valmat.ru/tags/archive" term="archive" label="archive" />
        </entry>
        <entry>
            <title>Как в PHP узнать протокол (https)</title>
            <link href="https://valmat.ru/posts/archive/2013/01/php-scheme-https/" rel="alternate" type="text/html"  hreflang="en" />
            <id>https://valmat.ru/posts/archive/2013/01/php-scheme-https/</id>
            <published>2013-01-17T16:07:00+00:00</published>
            <updated>2013-01-17T16:07:00+00:00</updated>
            <content type="html">
                &lt;p&gt;Оказывается, узнать, что сайт использует &lt;strong&gt;SSL&lt;/strong&gt; и страница открыта по протоколу &lt;strong&gt;https&lt;/strong&gt; — не настолько тривиальная задача, чтобы решить её с наскока.&lt;br&gt;
Однако, решение оказалось достаточно простое.&lt;/p&gt;
&lt;p&gt;Проблема заключается в том, что для определения протокола могут быть использованы переменные:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-php&#34; data-lang=&#34;php&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$_SERVER&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;HTTPS&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$_SERVER&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;HTTP_SCHEME&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$_SERVER&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;HTTP_X_FORWARDED_PROTO&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;И косвенно:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-php&#34; data-lang=&#34;php&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$_SERVER&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;SERVER_PORT&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Но все эти переменные, кроме номера порта, почти наверняка будут отсутствовать.&lt;br&gt;
Определять http-схему, основываясь только на номере порта — приемлемое, но не очень гибкое решение.&lt;/p&gt;
&lt;p&gt;Я сделал так:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-php&#34; data-lang=&#34;php&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$scheme&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;isset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$_SERVER&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;HTTP_SCHEME&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;?&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$_SERVER&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;HTTP_SCHEME&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;isset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$_SERVER&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;HTTPS&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$_SERVER&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;HTTPS&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;off&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;o&#34;&gt;||&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;443&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$_SERVER&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;SERVER_PORT&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;?&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;https&amp;#39;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;http&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;И для надёжности, чтобы &lt;code&gt;$_SERVER[&#39;HTTP_SCHEME&#39;]&lt;/code&gt; была определена, в &lt;code&gt;nginx.conf&lt;/code&gt; добавил строчку:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-nginx&#34; data-lang=&#34;nginx&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# for SSL
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;fastcgi_param&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;HTTP_SCHEME&lt;/span&gt;  &lt;span class=&#34;nv&#34;&gt;$scheme&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
            </content>    
                                <category scheme="https://valmat.ru/tags/archive" term="archive" label="archive" />
        </entry>
        <entry>
            <title>Мозаика из фотографий с помощью convert (ImageMagick)</title>
            <link href="https://valmat.ru/posts/archive/2012/12/mosaic-convert-imagemagic/" rel="alternate" type="text/html"  hreflang="en" />
            <id>https://valmat.ru/posts/archive/2012/12/mosaic-convert-imagemagic/</id>
            <published>2012-12-06T21:56:00+00:00</published>
            <updated>2012-12-06T21:56:00+00:00</updated>
            <content type="html">
                &lt;p&gt;Из фотографий или картинок одинакового размера можно сделать мозаику. Получается интересный эффект.&lt;/p&gt;
&lt;p&gt;Для этого я написал два bash-скрипта.&lt;/p&gt;
&lt;p&gt;Первый уменьшает размеры фотографий, второй делает из миниатюр мозаику.&lt;/p&gt;
&lt;div class=&#34;flex align-center gblog-post__anchorwrap&#34;&gt;
    &lt;h3 id=&#34;скрипт-для-уменьшения-фотографий&#34;
    &gt;
        Скрипт для уменьшения фотографий
    &lt;/h3&gt;
    &lt;a data-clipboard-text=&#34;https://valmat.ru/posts/archive/2012/12/mosaic-convert-imagemagic/#скрипт-для-уменьшения-фотографий&#34; class=&#34;gblog-post__anchor clip flex align-center&#34; aria-label=&#34;Anchor Скрипт для уменьшения фотографий&#34; href=&#34;#%d1%81%d0%ba%d1%80%d0%b8%d0%bf%d1%82-%d0%b4%d0%bb%d1%8f-%d1%83%d0%bc%d0%b5%d0%bd%d1%8c%d1%88%d0%b5%d0%bd%d0%b8%d1%8f-%d1%84%d0%be%d1%82%d0%be%d0%b3%d1%80%d0%b0%d1%84%d0%b8%d0%b9&#34;&gt;
        &lt;svg class=&#34;gblog-icon gblog_link&#34;&gt;&lt;use xlink:href=&#34;#gblog_link&#34;&gt;&lt;/use&gt;&lt;/svg&gt;
    &lt;/a&gt;
&lt;/div&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#!/bin/bash
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;SW&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;150&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;SH&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;150&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;FROMDIR&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;fromdir&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;TODIR&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;todir&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; name in &lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;ls &lt;span class=&#34;nv&#34;&gt;$FROMDIR&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  convert -resize &lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;SW&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;x&lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;SH&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt; -strip &lt;span class=&#34;nv&#34;&gt;$FROMDIR&lt;/span&gt;/&lt;span class=&#34;nv&#34;&gt;$name&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$TODIR&lt;/span&gt;/&lt;span class=&#34;nv&#34;&gt;$name&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;done&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Здесь:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;SW&lt;/code&gt; — ограничение ширины миниатюры;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;SH&lt;/code&gt; — ограничение высоты миниатюры;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;FROMDIR&lt;/code&gt; — каталог, в котором находятся фотографии;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;TODIR&lt;/code&gt; — каталог, в который будут сложены миниатюры.&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;div class=&#34;flex align-center gblog-post__anchorwrap&#34;&gt;
    &lt;h3 id=&#34;скрипт-для-создания-мозаики-из-миниатюр&#34;
    &gt;
        Скрипт для создания мозаики из миниатюр
    &lt;/h3&gt;
    &lt;a data-clipboard-text=&#34;https://valmat.ru/posts/archive/2012/12/mosaic-convert-imagemagic/#скрипт-для-создания-мозаики-из-миниатюр&#34; class=&#34;gblog-post__anchor clip flex align-center&#34; aria-label=&#34;Anchor Скрипт для создания мозаики из миниатюр&#34; href=&#34;#%d1%81%d0%ba%d1%80%d0%b8%d0%bf%d1%82-%d0%b4%d0%bb%d1%8f-%d1%81%d0%be%d0%b7%d0%b4%d0%b0%d0%bd%d0%b8%d1%8f-%d0%bc%d0%be%d0%b7%d0%b0%d0%b8%d0%ba%d0%b8-%d0%b8%d0%b7-%d0%bc%d0%b8%d0%bd%d0%b8%d0%b0%d1%82%d1%8e%d1%80&#34;&gt;
        &lt;svg class=&#34;gblog-icon gblog_link&#34;&gt;&lt;use xlink:href=&#34;#gblog_link&#34;&gt;&lt;/use&gt;&lt;/svg&gt;
    &lt;/a&gt;
&lt;/div&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#!/bin/bash
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;SW&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;150&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;SH&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;112&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;COLS&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;15&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;REZFILE&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;mosaic-`date &amp;#34;&lt;/span&gt;+%Y-%m-%d_%H_%M_%S&lt;span class=&#34;s2&#34;&gt;&amp;#34;`.jpg&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;FDIR&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;small&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;convert &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; name in &lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;ls &lt;span class=&#34;nv&#34;&gt;$FDIR&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; sort -R&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; -n &lt;span class=&#34;s2&#34;&gt;&amp;#34; -page +&lt;/span&gt;$&lt;span class=&#34;s2&#34;&gt;[(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$i&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;%&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$COLS&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;)*&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$SW&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;]+&lt;/span&gt;$&lt;span class=&#34;s2&#34;&gt;[((&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$i&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$i&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;%&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$COLS&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;)/&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$COLS&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;)*&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$SH&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;] &lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$FDIR&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$name&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;$&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$i&lt;/span&gt;+1&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;done)&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; -mosaic &lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$REZFILE&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Здесь:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;SW&lt;/code&gt; — ширина миниатюры;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;SH&lt;/code&gt; — высота миниатюры;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;COLS&lt;/code&gt; — количество столбцов;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;REZFILE&lt;/code&gt; — имя файла с мозаикой;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;FDIR&lt;/code&gt; — каталог с миниатюрами.&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Важно:&lt;/strong&gt; Все миниатюры должны быть одинакового размера, иначе будут пустоты.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Чтобы мозаика повторяла пропорции исходных фотографий, должно быть:&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;SW == SH&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Число фотографий должно равняться произведению:&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;SW * SH&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;В последнем скрипте используется &lt;code&gt;sort -R&lt;/code&gt; для случайного упорядочивания. Если его убрать, будет тот порядок, в котором выдает &lt;code&gt;ls&lt;/code&gt;.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Вот пример мозаики из аватарок пользователей сайта:&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;./mosaic-xmpl.jpg&#34;
  alt=&#34;Пример мозаики&#34;
  
/&gt;&lt;/p&gt;

            </content>    
                                <category scheme="https://valmat.ru/tags/archive" term="archive" label="archive" />
        </entry>
        <entry>
            <title>Установка Redis via unix.socket</title>
            <link href="https://valmat.ru/posts/archive/2011/12/redis-via-unixsocket/" rel="alternate" type="text/html"  hreflang="en" />
            <id>https://valmat.ru/posts/archive/2011/12/redis-via-unixsocket/</id>
            <published>2011-12-03T07:05:00+00:00</published>
            <updated>2011-12-03T07:05:00+00:00</updated>
            <content type="html">
                &lt;div class=&#34;flex align-center gblog-post__anchorwrap&#34;&gt;
    &lt;h2 id=&#34;о-том-как-установить-redis-в-качестве-сервера-на-linux-и-обращаться-к-нему-через-unixsocket&#34;
    &gt;
        О том, как установить Redis в качестве сервера на Linux и обращаться к нему через Unix.socket
    &lt;/h2&gt;
    &lt;a data-clipboard-text=&#34;https://valmat.ru/posts/archive/2011/12/redis-via-unixsocket/#о-том-как-установить-redis-в-качестве-сервера-на-linux-и-обращаться-к-нему-через-unixsocket&#34; class=&#34;gblog-post__anchor clip flex align-center&#34; aria-label=&#34;Anchor О том, как установить Redis в качестве сервера на Linux и обращаться к нему через Unix.socket&#34; href=&#34;#%d0%be-%d1%82%d0%be%d0%bc-%d0%ba%d0%b0%d0%ba-%d1%83%d1%81%d1%82%d0%b0%d0%bd%d0%be%d0%b2%d0%b8%d1%82%d1%8c-redis-%d0%b2-%d0%ba%d0%b0%d1%87%d0%b5%d1%81%d1%82%d0%b2%d0%b5-%d1%81%d0%b5%d1%80%d0%b2%d0%b5%d1%80%d0%b0-%d0%bd%d0%b0-linux-%d0%b8-%d0%be%d0%b1%d1%80%d0%b0%d1%89%d0%b0%d1%82%d1%8c%d1%81%d1%8f-%d0%ba-%d0%bd%d0%b5%d0%bc%d1%83-%d1%87%d0%b5%d1%80%d0%b5%d0%b7-unixsocket&#34;&gt;
        &lt;svg class=&#34;gblog-icon gblog_link&#34;&gt;&lt;use xlink:href=&#34;#gblog_link&#34;&gt;&lt;/use&gt;&lt;/svg&gt;
    &lt;/a&gt;
&lt;/div&gt;
&lt;p&gt;По мотивам куцей доки: &lt;a
  class=&#34;gblog-markdown__link&#34;
  href=&#34;http://redis.io/topics/quickstart&#34;
&gt;http://redis.io/topics/quickstart&lt;/a&gt; и &lt;a
  class=&#34;gblog-markdown__link&#34;
  href=&#34;http://redis.io/download&#34;
&gt;http://redis.io/download&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;От рута делаем:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mkdir /usr/src/redis
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; /usr/src/redis
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;wget http://redis.googlecode.com/files/redis-2.4.4.tar.gz
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tar xzf redis-2.4.4.tar.gz
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; redis-2.4.4
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;make &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; make &lt;span class=&#34;nb&#34;&gt;test&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Если тесты прошли нормально (должно быть написано что-то вроде этого: &amp;ldquo;\o/ All tests passed without errors!&amp;rdquo;), то двигаемся дальше.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mv ../redis-2.4.4.tar.gz ./redis-2.4.4.tar.gz
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cp src/redis-server /usr/local/bin/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cp src/redis-cli /usr/local/bin/
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mkdir /etc/redis
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mkdir /var/redis
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Далее в доке предлагается сделать &lt;code&gt;cp utils/redis_init_script /etc/init.d/redis_6379&lt;/code&gt;, где 6379 — номер дефолтного порта, но я планирую, что Redis будет работать у меня через unix.socket, поэтому будет так (везде далее нолик появляется именно по этой же причине):&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cp utils/redis_init_script /etc/init.d/redis_0
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Теперь нужно подредактировать конфиг:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;nano /etc/init.d/redis_0
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Редактированию там подлежит только номер порта (6-я строка):&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;REDISPORT=6379  --&amp;gt;  REDISPORT=0
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Если номер порта не менять, то и редактировать ничего не нужно.&lt;/p&gt;
&lt;p&gt;Но в моем случае, поскольку я планирую запускать редис через unix socket, то нужно еще внести несколько изменений:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Добавляем переменную:
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;UNIXSOCK=/tmp/redis.sock
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;Выражение &lt;code&gt;$CLIEXEC -p $REDISPORT shutdown&lt;/code&gt; в секции &amp;ldquo;stop&amp;rdquo; заменяем на &lt;code&gt;$CLIEXEC -s $UNIXSOCK shutdown&lt;/code&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Вот что получилось:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#!/bin/sh
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;REDISPORT&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;#REDISPORT=6379&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;UNIXSOCK&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/tmp/redis.sock
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;OWNER&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;nobody
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;EXEC&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/usr/local/bin/redis-server
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;CLIEXEC&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/usr/local/bin/redis-cli
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;PIDFILE&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/var/run/redis_&lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;REDISPORT&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;.pid
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;CONF&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/etc/redis/&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;REDISPORT&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;.conf&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$1&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt; in
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  start&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt; -f &lt;span class=&#34;nv&#34;&gt;$PIDFILE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;k&#34;&gt;then&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$PIDFILE&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; exists, process is already running or crashed&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Starting Redis server...&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;nv&#34;&gt;$EXEC&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$CONF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;k&#34;&gt;fi&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  stop&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt; ! -f &lt;span class=&#34;nv&#34;&gt;$PIDFILE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;k&#34;&gt;then&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$PIDFILE&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; does not exist, process is not running&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;nv&#34;&gt;PID&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;cat &lt;span class=&#34;nv&#34;&gt;$PIDFILE&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Stopping ...&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;c1&#34;&gt;#$CLIEXEC -p $REDISPORT shutdown&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;nv&#34;&gt;$CLIEXEC&lt;/span&gt; -s &lt;span class=&#34;nv&#34;&gt;$UNIXSOCK&lt;/span&gt; shutdown
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;k&#34;&gt;while&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt; -x /proc/&lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;PID&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                  &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Waiting for Redis to shutdown .&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                  sleep 0.5
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                  &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; -n &lt;span class=&#34;s2&#34;&gt;&amp;#34;..&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                  sleep 0.5
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                  &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; -n &lt;span class=&#34;s2&#34;&gt;&amp;#34;..&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;k&#34;&gt;done&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Redis stopped&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;k&#34;&gt;fi&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  restart&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt; ! -f &lt;span class=&#34;nv&#34;&gt;$PIDFILE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;k&#34;&gt;then&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$PIDFILE&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; does not exist, process is not running&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;nv&#34;&gt;PID&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;cat &lt;span class=&#34;nv&#34;&gt;$PIDFILE&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Stopping ...&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;c1&#34;&gt;#$CLIEXEC -p $REDISPORT shutdown&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;nv&#34;&gt;$CLIEXEC&lt;/span&gt; -s &lt;span class=&#34;nv&#34;&gt;$UNIXSOCK&lt;/span&gt; shutdown
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;k&#34;&gt;while&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt; -x /proc/&lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;PID&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                  &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Waiting for Redis to shutdown ...&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                  sleep &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;k&#34;&gt;done&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Redis stopped&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;k&#34;&gt;fi&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Starting Redis server...&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nv&#34;&gt;$EXEC&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$CONF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  *&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Please use start or stop as first argument&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;esac&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Далее нам нужно скопировать файл конфига:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cp redis.conf /etc/redis/0.conf
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;И отредактировать его:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;nano /etc/redis/0.conf
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;В нем меняем следующее:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-ini&#34; data-lang=&#34;ini&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;#daemonize no&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;daemonize yes&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;#pidfile /var/run/redis.pid&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;pidfile /var/run/redis_0.pid&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;#port 6379&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;port 0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;bind 127.0.0.1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;unixsocket /tmp/redis.sock&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;unixsocketperm 755&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;#loglevel verbose&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;loglevel warning&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;#logfile stdout&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;logfile /var/log/redis_0.log&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;#databases 16&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;databases 1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;В секции &amp;ldquo;SNAPSHOTTING&amp;rdquo; можно поменять стратегию дампов. Я сделал так:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-ini&#34; data-lang=&#34;ini&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;save 54000 10&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;save 3600 5000&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;dir /var/redis/dumps/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;dbfilename dump_0.rdb&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Поскольку в сеть смотреть мой редис не будет, то репликацию я в нем отключил (секция &amp;lsquo;REPLICATION&amp;rsquo;):&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-ini&#34; data-lang=&#34;ini&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;#slave-serve-stale-data yes&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;slave-serve-stale-data no&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Далее, поскольку, как и сказано в конфиге, я собираюсь использовать редис не в качестве основной БД, а в качестве кеша, то стоит установить maxmemory, чтобы редис ненароком не сожрал всю память:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-ini&#34; data-lang=&#34;ini&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# 256 MB&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;maxmemory 268435456&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Поскольку maxmemory установлен, то нужно установить и maxmemory-policy:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-ini&#34; data-lang=&#34;ini&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# maxmemory-policy volatile-lru&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;maxmemory-policy volatile-ttl&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Выбрал &lt;code&gt;volatile-ttl&lt;/code&gt;, потому что не знаю, как работает алгоритм LRU.&lt;/p&gt;
&lt;p&gt;Отключаем appendfsync:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-ini&#34; data-lang=&#34;ini&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;appendfsync no&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Все, на этом правки конфига закончены.&lt;/p&gt;
&lt;p&gt;Для логов мы указывали каталог &lt;code&gt;/var/redis/dumps&lt;/code&gt;. Его нужно не забыть создать:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mkdir /var/redis/dumps
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Проверяем, все ли работает. Проверить можно так:&lt;/p&gt;
&lt;p&gt;Запускаем:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/etc/init.d/redis_0 start
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Потом:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;redis-cli -s /tmp/redis.sock
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;В консоли redis:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;SET key1 &amp;#34;Test&amp;#34;
OK
GET key1
&amp;#34;Test&amp;#34;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Если все нормально, то добавляем в автозагрузку:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;update-rc.d redis_0 defaults
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;PS&lt;/strong&gt;&lt;br&gt;
В логах редиса он сообщил мне следующее предупреждение:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;WARNING overcommit_memory is set to 0! Background save may fail under low memory condition. To fix this issue add &amp;#39;vm.overcommit_memory = 1&amp;#39; to /etc/sysctl.conf and then reboot or run the command &amp;#39;sysctl vm.overcommit_memory=1&amp;#39; for this to take effect.
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Поскольку я готов мириться с тем, что он не будет дампить себя на диск, то это предупреждение проигнорирую.
А вообще решение вижу таким:&lt;/p&gt;
&lt;p&gt;В &lt;code&gt;/etc/sysctl.conf&lt;/code&gt; ничего, естественно, не вносим, но в &lt;code&gt;/etc/init.d/redis_0&lt;/code&gt;&lt;br&gt;
В секции старт, перед запуском редиса, сохраняем системное значение overcommit_memory:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;touch /tmp/overcommit_memory_bfr_redis
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;chmod &lt;span class=&#34;m&#34;&gt;0600&lt;/span&gt; /tmp/overcommit_memory_bfr_redis
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cat /proc/sys/vm/overcommit_memory &amp;gt; /tmp/overcommit_memory_bfr_redis
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sysctl vm.overcommit_memory&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;А в секцию стоп возвращаем системное значение:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;OCMSYS&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;cat /tmp/overcommit_memory_bfr_redis&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sysctl vm.overcommit_memory&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$OCMSYS&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Примерно так:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#!/bin/sh
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;REDISPORT&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;#REDISPORT=6379&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;UNIXSOCK&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/tmp/redis.sock
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;OWNER&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;nobody
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;EXEC&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/usr/local/bin/redis-server
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;CLIEXEC&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/usr/local/bin/redis-cli
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;PIDFILE&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/var/run/redis_&lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;REDISPORT&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;.pid
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;CONF&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/etc/redis/&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;REDISPORT&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;.conf&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;#fix WARNING about overcommit_memory&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;FWOBOM&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;FALSE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$1&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt; in
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  start&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt; -f &lt;span class=&#34;nv&#34;&gt;$PIDFILE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;k&#34;&gt;then&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$PIDFILE&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; exists, process is already running or crashed&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Starting Redis server...&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;c1&#34;&gt;# -- fix WARNING about overcommit_memory&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;TRUE&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$FWOBOM&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;k&#34;&gt;then&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                touch /tmp/overcommit_memory_bfr_redis
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                chmod &lt;span class=&#34;m&#34;&gt;0600&lt;/span&gt; /tmp/overcommit_memory_bfr_redis
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                cat /proc/sys/vm/overcommit_memory &amp;gt; /tmp/overcommit_memory_bfr_redis
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                sysctl vm.overcommit_memory&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;k&#34;&gt;fi&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;c1&#34;&gt;# &amp;lt;--&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;nv&#34;&gt;$EXEC&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$CONF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;k&#34;&gt;fi&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  stop&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt; ! -f &lt;span class=&#34;nv&#34;&gt;$PIDFILE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;k&#34;&gt;then&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$PIDFILE&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; does not exist, process is not running&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;nv&#34;&gt;PID&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;cat &lt;span class=&#34;nv&#34;&gt;$PIDFILE&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Stopping ...&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;c1&#34;&gt;#$CLIEXEC -p $REDISPORT shutdown&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;nv&#34;&gt;$CLIEXEC&lt;/span&gt; -s &lt;span class=&#34;nv&#34;&gt;$UNIXSOCK&lt;/span&gt; shutdown
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;k&#34;&gt;while&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt; -x /proc/&lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;PID&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                  &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Waiting for Redis to shutdown .&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                  sleep 0.5
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                  &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; -n &lt;span class=&#34;s2&#34;&gt;&amp;#34;..&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                  sleep 0.5
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                  &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; -n &lt;span class=&#34;s2&#34;&gt;&amp;#34;..&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;k&#34;&gt;done&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;c1&#34;&gt;# -- fix WARNING about overcommit_memory&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;TRUE&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$FWOBOM&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;k&#34;&gt;then&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nv&#34;&gt;OCMSYS&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;cat /tmp/overcommit_memory_bfr_redis&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                sysctl vm.overcommit_memory&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$OCMSYS&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;k&#34;&gt;fi&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;c1&#34;&gt;# &amp;lt;--&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Redis stopped&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;k&#34;&gt;fi&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  restart&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt; ! -f &lt;span class=&#34;nv&#34;&gt;$PIDFILE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;k&#34;&gt;then&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$PIDFILE&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; does not exist, process is not running&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;nv&#34;&gt;PID&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;cat &lt;span class=&#34;nv&#34;&gt;$PIDFILE&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Stopping ...&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;c1&#34;&gt;#$CLIEXEC -p $REDISPORT shutdown&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;nv&#34;&gt;$CLIEXEC&lt;/span&gt; -s &lt;span class=&#34;nv&#34;&gt;$UNIXSOCK&lt;/span&gt; shutdown
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;k&#34;&gt;while&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt; -x /proc/&lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;PID&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                  &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Waiting for Redis to shutdown ...&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                  sleep &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;k&#34;&gt;done&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Redis stopped&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;k&#34;&gt;fi&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Starting Redis server...&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;c1&#34;&gt;# -- fix WARNING about overcommit_memory&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;TRUE&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$FWOBOM&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;k&#34;&gt;then&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        touch /tmp/overcommit_memory_bfr_redis
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        chmod &lt;span class=&#34;m&#34;&gt;0600&lt;/span&gt; /tmp/overcommit_memory_bfr_redis
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        cat /proc/sys/vm/overcommit_memory &amp;gt; /tmp/overcommit_memory_bfr_redis
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        sysctl vm.overcommit_memory&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;k&#34;&gt;fi&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;c1&#34;&gt;# &amp;lt;--&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nv&#34;&gt;$EXEC&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$CONF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  *&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Please use start or stop as first argument&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;esac&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;PPS&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;overcommit_memory влияет на выделение памяти ядром и на работу OOM Killer.&lt;br&gt;
&lt;code&gt;vm.overcommit_memory=0&lt;/code&gt; — более безопасный вариант, т.к. кто его знает, кого грохнет OOM Killer, если память кончится.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Если tcp сокет устраивает, а нужно только (возможно задать порт), то в каталоге utils с исходниками есть скрипт &lt;code&gt;install_server.sh&lt;/code&gt;, запуск которого сделает большую часть грязной работы, описанной выше.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;По поводу maxmemory-policy volatile-lru vs volatile-ttl: &lt;a
  class=&#34;gblog-markdown__link&#34;
  href=&#34;http://habrahabr.ru/blogs/development/136758/&#34;
&gt;статья на хабре про LRU&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;

            </content>    
                                <category scheme="https://valmat.ru/tags/archive" term="archive" label="archive" />
        </entry>
        <entry>
            <title>Библиотека для загрузки фотографий на сайт</title>
            <link href="https://valmat.ru/posts/archive/2011/10/transimage-php/" rel="alternate" type="text/html"  hreflang="en" />
            <id>https://valmat.ru/posts/archive/2011/10/transimage-php/</id>
            <published>2011-10-01T11:24:00+00:00</published>
            <updated>2011-10-01T11:24:00+00:00</updated>
            <content type="html">
                &lt;p&gt;&lt;strong&gt;transImage&lt;/strong&gt; — это &lt;em&gt;PHP библиотека для простой загрузки фотографий на сайт&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;Она умеет:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Получать изображение из файла, автоматически нормализовать его размер для экономии памяти&lt;/li&gt;
&lt;li&gt;Автоматически поворачивать исходное изображение по данным Exif&lt;/li&gt;
&lt;li&gt;Создавать копии себя с изменёнными размерами, изменять свой размер&lt;/li&gt;
&lt;li&gt;Наносить водяные знаки. Поддерживает любые водяные знаки, соответствующие интерфейсу &lt;code&gt;waterMark&lt;/code&gt; (см. код)&lt;/li&gt;
&lt;li&gt;Выводить результат клиенту или сохранять его в файловую систему&lt;/li&gt;
&lt;li&gt;Подкладывать белый фон, если исходное изображение поддерживает прозрачность&lt;/li&gt;
&lt;li&gt;Быстро создавать миниатюру для предпросмотра, используя миниатюру из Exif&lt;/li&gt;
&lt;li&gt;Преобразовывать изображения в строку для использования их с &lt;code&gt;data:URI&lt;/code&gt;. В этом случае небольшие изображения можно передавать с другими параметрами в формате JSON (при использовании Ajax)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Для более подробной информации смотрите комментарии в коде.&lt;/p&gt;
&lt;p&gt;Подходит большинству сайтов, которым нужно получить от клиента фотографию, правильно преобразовать её в соответствии с Exif, создать несколько вариантов с разными размерами и, возможно, нанести водяной знак.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Не рекомендую использовать её для выдачи клиенту (браузеру) изображений больших размеров.&lt;/strong&gt; Эта функция несёт исключительно демонстративную нагрузку.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Лицензия:&lt;/strong&gt; BSD.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;GitHub repo:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;./ghlogo.png&#34;
  alt=&#34;GitHub Logo&#34;
  
/&gt;&lt;/p&gt;
&lt;p&gt;&lt;a
  class=&#34;gblog-markdown__link&#34;
  href=&#34;https://github.com/valmat/transImage&#34;
&gt;https://github.com/valmat/transImage&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;./transImage_640x480.png&#34;
  alt=&#34;Пример работы transImage&#34;
  
/&gt;&lt;/p&gt;

            </content>    
                                <category scheme="https://valmat.ru/tags/archive" term="archive" label="archive" />
        </entry>
        <entry>
            <title>Замена салонного фильтра на Fiat Albea</title>
            <link href="https://valmat.ru/posts/archive/2011/09/fiat-albea-cabin-filter/" rel="alternate" type="text/html"  hreflang="en" />
            <id>https://valmat.ru/posts/archive/2011/09/fiat-albea-cabin-filter/</id>
            <published>2011-09-02T17:23:00+00:00</published>
            <updated>2011-09-02T17:23:00+00:00</updated>
            <content type="html">
                &lt;p&gt;Для замены салонного фильтра понадобятся:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;фильтр&lt;/li&gt;
&lt;li&gt;крестовая отвертка&lt;/li&gt;
&lt;li&gt;фонарик&lt;/li&gt;
&lt;li&gt;тряпка под коленки&lt;/li&gt;
&lt;li&gt;хорошая погода&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Операция занимает 15 минут. Перед входом со стороны переднего пассажира лучше бросить тряпку, потому что, чтобы добраться до фильтра, придётся встать на колени и залезть под бардачок.&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;./1.jpg_new.jpg&#34;
  alt=&#34;Салон Fiat Albea, вид на место установки фильтра&#34;
  
/&gt;&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;./2.jpg_new.jpg&#34;
  alt=&#34;Вид под бардачком, где расположен салонный фильтр&#34;
  
/&gt;&lt;/p&gt;
&lt;p&gt;Фильтр находится под бардачком.&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;./3.jpg_new.jpg&#34;
  alt=&#34;Расположение фильтра крупным планом&#34;
  
/&gt;&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;./4.jpg_new.jpg&#34;
  alt=&#34;Крышка фильтра&#34;
  
/&gt;&lt;/p&gt;
&lt;p&gt;Крепится двумя шурупами.&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;./5.jpg_new.jpg&#34;
  alt=&#34;Откручивание креплений&#34;
  
/&gt;&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;./6.jpg_new.jpg&#34;
  alt=&#34;Снятие крышки фильтра&#34;
  
/&gt;&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;./7.jpg_new.jpg&#34;
  alt=&#34;Вид на фильтр после снятия крышки&#34;
  
/&gt;&lt;/p&gt;
&lt;p&gt;Следующие две фотографии должны сподвигнуть увидевших их на срочную замену фильтра в своей машине. Я не менял фильтр два года.&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;./8.jpg_new.jpg&#34;
  alt=&#34;Старый фильтр, вид 1&#34;
  
/&gt;&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;./9.jpg_new.jpg&#34;
  alt=&#34;Старый фильтр, вид 2&#34;
  
/&gt;&lt;/p&gt;
&lt;p&gt;Я поставил себе угольный фильтр. Его код: &lt;strong&gt;9.7.541&lt;/strong&gt; (260 руб. на экзисте).&lt;/p&gt;
&lt;p&gt;Можно не извращаться и поставить обычный — будет дешевле. Код обычного фильтра: &lt;strong&gt;9.7.540&lt;/strong&gt; (150 руб. на экзисте).&lt;/p&gt;

            </content>    
                                <category scheme="https://valmat.ru/tags/archive" term="archive" label="archive" />
        </entry>
        <entry>
            <title>Установка ветровиков на Fiat Albea</title>
            <link href="https://valmat.ru/posts/archive/2011/09/fiat-albea/" rel="alternate" type="text/html"  hreflang="en" />
            <id>https://valmat.ru/posts/archive/2011/09/fiat-albea/</id>
            <published>2011-09-02T14:58:00+00:00</published>
            <updated>2011-09-02T14:58:00+00:00</updated>
            <content type="html">
                &lt;p&gt;Наконец-то установил ветровики на свой Фиат.&lt;/p&gt;
&lt;p&gt;Вот что получилось:&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;./02092011133.jpg&#34;
  alt=&#34;Fiat Albea с ветровиками, фото 1&#34;
  
/&gt;&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;./02092011134.jpg&#34;
  alt=&#34;Fiat Albea с ветровиками, фото 2&#34;
  
/&gt;&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;./02092011135.jpg&#34;
  alt=&#34;Fiat Albea с ветровиками, фото 3&#34;
  
/&gt;&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;./02092011136.jpg&#34;
  alt=&#34;Fiat Albea с ветровиками, фото 4&#34;
  
/&gt;&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;./02092011137.jpg&#34;
  alt=&#34;Fiat Albea с ветровиками, фото 5 (вертикальное фото)&#34;
  
/&gt;&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;./02092011138.jpg&#34;
  alt=&#34;Fiat Albea с ветровиками, фото 6&#34;
  
/&gt;&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;./02092011139.jpg&#34;
  alt=&#34;Fiat Albea с ветровиками, фото 7&#34;
  
/&gt;&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;./02092011140.jpg&#34;
  alt=&#34;Fiat Albea с ветровиками, фото 8&#34;
  
/&gt;&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;./02092011142.jpg&#34;
  alt=&#34;Fiat Albea с ветровиками, фото 9&#34;
  
/&gt;&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;./02092011143.jpg&#34;
  alt=&#34;Fiat Albea с ветровиками, фото 10&#34;
  
/&gt;&lt;/p&gt;
&lt;p&gt;Код дефлекторов: &lt;strong&gt;D07061&lt;/strong&gt;&lt;/p&gt;

            </content>    
                                <category scheme="https://valmat.ru/tags/archive" term="archive" label="archive" />
        </entry>
        <entry>
            <title>Рыбацкие снасти из Китая</title>
            <link href="https://valmat.ru/posts/archive/2011/04/china-fishing-tackle/" rel="alternate" type="text/html"  hreflang="en" />
            <id>https://valmat.ru/posts/archive/2011/04/china-fishing-tackle/</id>
            <published>2011-04-11T16:22:00+00:00</published>
            <updated>2011-04-11T16:22:00+00:00</updated>
            <content type="html">
                &lt;p&gt;Сегодня наконец-то пришла моя рыбацкая посылка из Гонконга.&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;./0.jpg&#34;
  alt=&#34;Посылка из Гонконга&#34;
  
/&gt;&lt;/p&gt;
&lt;p&gt;А именно, сделал небольшой пробный заказ на китайском сайте &lt;a
  class=&#34;gblog-markdown__link&#34;
  href=&#34;http://www.focalprice.com/detail_HL568X.html&#34;
&gt;focalprice.com&lt;/a&gt;.&lt;br&gt;
До этого заказывал только на dealextreme.com.&lt;/p&gt;
&lt;p&gt;Заказывал:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a
  class=&#34;gblog-markdown__link&#34;
  href=&#34;http://www.focalprice.com/detail_HL568X.html&#34;
&gt;Воблер&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a
  class=&#34;gblog-markdown__link&#34;
  href=&#34;http://www.focalprice.com/detail_HL555X.html&#34;
&gt;Набор воблеров&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a
  class=&#34;gblog-markdown__link&#34;
  href=&#34;http://www.focalprice.com/detail_HL289X.html&#34;
&gt;Набор виброхвостов&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a
  class=&#34;gblog-markdown__link&#34;
  href=&#34;http://www.focalprice.com/detail_HL332G.html&#34;
&gt;Доставалку крючка из щучьей пасти&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Шло около месяца, хотя я надеялся, что придет быстрее. Рыболовный сезон откроется не скоро, но тем не менее стоит учитывать. Отправили на следующий день после заказа — это, безусловно, плюс. В делекстриме бывает, что по две недели ждёшь отправки.&lt;/p&gt;
&lt;p&gt;Качество товара вполне ожидаемое. Примерно то же самое продаётся у нас в 90% рыбацких магазинов, но за большие деньги.&lt;/p&gt;
&lt;p&gt;Воблер пришёл другой расцветки. Я заказывал жёлтого цвета, пришёл серебристый с красной башкой:&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;./HL568X.JPG&#34;
  alt=&#34;Воблер — пришёл другой расцветки&#34;
  
/&gt;&lt;/p&gt;
&lt;p&gt;Виброхвосты, я ожидал, должны были быть побольше. Но тут уж сам виноват — на сайте размеры указаны. Хотя, впрочем, я не расстроился. Маленькую рыбу тоже нужно чем-то ловить.&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;./6.jpg&#34;
  alt=&#34;Виброхвосты&#34;
  
/&gt;&lt;/p&gt;
&lt;p&gt;Джиги, как видно, тоже маленькие — грамм по пять.&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;./2.jpg&#34;
  alt=&#34;Джиги&#34;
  
/&gt;
&lt;img
  src=&#34;./1.jpg&#34;
  alt=&#34;Джиги, вид 2&#34;
  
/&gt;&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;./4.jpg&#34;
  alt=&#34;Джиги, вид 3&#34;
  
/&gt;
&lt;img
  src=&#34;./3.jpg&#34;
  alt=&#34;Джиги, вид 4&#34;
  
/&gt;&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;./7.jpg&#34;
  alt=&#34;Джиги, вид 5&#34;
  
/&gt;
&lt;img
  src=&#34;./5.jpg&#34;
  alt=&#34;Джиги, вид 6&#34;
  
/&gt;&lt;/p&gt;
&lt;p&gt;Также обратил внимание, что посылка почему-то шла через Брянск, и на Брянской таможне её вскрывали:&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;./10.JPG&#34;
  alt=&#34;Посылка вскрыта на таможне&#34;
  
/&gt;
&lt;img
  src=&#34;./9.jpg&#34;
  alt=&#34;Маркировка после вскрытия&#34;
  
/&gt;&lt;/p&gt;

            </content>    
                                <category scheme="https://valmat.ru/tags/archive" term="archive" label="archive" />
        </entry>
        <entry>
            <title>php Cacher</title>
            <link href="https://valmat.ru/posts/archive/2010/10/php-cacher/" rel="alternate" type="text/html"  hreflang="en" />
            <id>https://valmat.ru/posts/archive/2010/10/php-cacher/</id>
            <published>2010-10-30T10:48:00+00:00</published>
            <updated>2010-10-30T10:48:00+00:00</updated>
            <content type="html">
                &lt;p&gt;Опубликовал набор классов для кеширования:&lt;br&gt;
&lt;a
  class=&#34;gblog-markdown__link&#34;
  href=&#34;http://github.com/valmat/Cacher&#34;
&gt;http://github.com/valmat/Cacher&lt;/a&gt;&lt;br&gt;
Опубликовано под лицензией&lt;br&gt;
GPL v.3 (&lt;a
  class=&#34;gblog-markdown__link&#34;
  href=&#34;http://www.gnu.org/licenses/gpl.txt&#34;
&gt;http://www.gnu.org/licenses/gpl.txt&lt;/a&gt;)&lt;br&gt;
То есть свободно для использования и изменения. Разумеется, приветствуются любые исправления и дополнения.&lt;/p&gt;
&lt;div class=&#34;flex align-center gblog-post__anchorwrap&#34;&gt;
    &lt;h2 id=&#34;назначение&#34;
    &gt;
        Назначение
    &lt;/h2&gt;
    &lt;a data-clipboard-text=&#34;https://valmat.ru/posts/archive/2010/10/php-cacher/#назначение&#34; class=&#34;gblog-post__anchor clip flex align-center&#34; aria-label=&#34;Anchor Назначение&#34; href=&#34;#%d0%bd%d0%b0%d0%b7%d0%bd%d0%b0%d1%87%d0%b5%d0%bd%d0%b8%d0%b5&#34;&gt;
        &lt;svg class=&#34;gblog-icon gblog_link&#34;&gt;&lt;use xlink:href=&#34;#gblog_link&#34;&gt;&lt;/use&gt;&lt;/svg&gt;
    &lt;/a&gt;
&lt;/div&gt;
&lt;p&gt;Мне нужен был очень простой, но в то же время мощный кеширующий модуль с понятной логикой. При этом он должен быть пригодным для работы на односерверном, но в то же время нагруженном проекте.&lt;/p&gt;
&lt;p&gt;Также немаловажным моментом является возможность прозрачно менять стратегию кеширования в зависимости от текущего уровня нагрузки проекта.&lt;/p&gt;
&lt;p&gt;То есть решение должно удовлетворять требованию изменять стратегию кеширования по мере роста нагрузки на проект и по мере изменения аппаратных возможностей (речь об ОЗУ) сервера.&lt;/p&gt;
&lt;div class=&#34;flex align-center gblog-post__anchorwrap&#34;&gt;
    &lt;h2 id=&#34;архитектура&#34;
    &gt;
        Архитектура
    &lt;/h2&gt;
    &lt;a data-clipboard-text=&#34;https://valmat.ru/posts/archive/2010/10/php-cacher/#архитектура&#34; class=&#34;gblog-post__anchor clip flex align-center&#34; aria-label=&#34;Anchor Архитектура&#34; href=&#34;#%d0%b0%d1%80%d1%85%d0%b8%d1%82%d0%b5%d0%ba%d1%82%d1%83%d1%80%d0%b0&#34;&gt;
        &lt;svg class=&#34;gblog-icon gblog_link&#34;&gt;&lt;use xlink:href=&#34;#gblog_link&#34;&gt;&lt;/use&gt;&lt;/svg&gt;
    &lt;/a&gt;
&lt;/div&gt;
&lt;p&gt;Основными логическими единицами являются:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Cacher&lt;/strong&gt; — фронтенд к кеширующим классам.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Cacher_Backend&lt;/strong&gt; — собственно сами кеширующие классы.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Слоты&lt;/strong&gt; — кеширование и доступ к кешу осуществляется через слоты.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Теги&lt;/strong&gt; — для упрощения управления кешем и, главным образом, для переуеширования.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Типы кеширования&lt;/strong&gt; — для прозрачного изменения стратегии кеширования. То есть конкретный кеширующий бекенд подключается только через слот (или тег), которые, в свою очередь, оперируют типами. Таким образом, для изменения стратегии кеширования нужно всего лишь поменять привязку типов к бекендам.&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;flex align-center gblog-post__anchorwrap&#34;&gt;
    &lt;h2 id=&#34;использование&#34;
    &gt;
        Использование
    &lt;/h2&gt;
    &lt;a data-clipboard-text=&#34;https://valmat.ru/posts/archive/2010/10/php-cacher/#использование&#34; class=&#34;gblog-post__anchor clip flex align-center&#34; aria-label=&#34;Anchor Использование&#34; href=&#34;#%d0%b8%d1%81%d0%bf%d0%be%d0%bb%d1%8c%d0%b7%d0%be%d0%b2%d0%b0%d0%bd%d0%b8%d0%b5&#34;&gt;
        &lt;svg class=&#34;gblog-icon gblog_link&#34;&gt;&lt;use xlink:href=&#34;#gblog_link&#34;&gt;&lt;/use&gt;&lt;/svg&gt;
    &lt;/a&gt;
&lt;/div&gt;
&lt;div class=&#34;flex align-center gblog-post__anchorwrap&#34;&gt;
    &lt;h3 id=&#34;class-cacher&#34;
    &gt;
        class Cacher
    &lt;/h3&gt;
    &lt;a data-clipboard-text=&#34;https://valmat.ru/posts/archive/2010/10/php-cacher/#class-cacher&#34; class=&#34;gblog-post__anchor clip flex align-center&#34; aria-label=&#34;Anchor class Cacher&#34; href=&#34;#class-cacher&#34;&gt;
        &lt;svg class=&#34;gblog-icon gblog_link&#34;&gt;&lt;use xlink:href=&#34;#gblog_link&#34;&gt;&lt;/use&gt;&lt;/svg&gt;
    &lt;/a&gt;
&lt;/div&gt;
&lt;p&gt;Требует наличия классов, унаследованных от Cacher_Backend — семейство классов, реализующих бэкэнд для класса Cacher.&lt;/p&gt;
&lt;p&gt;Все операции с кешем осуществляются на низшем уровне через тот или иной бекенд.&lt;/p&gt;
&lt;p&gt;Бэкэндом может быть файловая система, shared memory, memcache, Sqlite и другие системы кеширования.&lt;/p&gt;
&lt;p&gt;Для работы с классом используются слоты и теги. Слоты реализованы в виде набора дружественных функций и неявно зашиты в интерфейс текущего класса.&lt;/p&gt;
&lt;div class=&#34;flex align-center gblog-post__anchorwrap&#34;&gt;
    &lt;h4 id=&#34;пример-использования&#34;
    &gt;
        Пример использования
    &lt;/h4&gt;
    &lt;a data-clipboard-text=&#34;https://valmat.ru/posts/archive/2010/10/php-cacher/#пример-использования&#34; class=&#34;gblog-post__anchor clip flex align-center&#34; aria-label=&#34;Anchor Пример использования&#34; href=&#34;#%d0%bf%d1%80%d0%b8%d0%bc%d0%b5%d1%80-%d0%b8%d1%81%d0%bf%d0%be%d0%bb%d1%8c%d0%b7%d0%be%d0%b2%d0%b0%d0%bd%d0%b8%d1%8f&#34;&gt;
        &lt;svg class=&#34;gblog-icon gblog_link&#34;&gt;&lt;use xlink:href=&#34;#gblog_link&#34;&gt;&lt;/use&gt;&lt;/svg&gt;
    &lt;/a&gt;
&lt;/div&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-php&#34; data-lang=&#34;php&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;define&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;AnyObj&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// может быть класс, массив или другой объект. 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// На основании этого объекта слот-функция вычислит ключ и, возможно, другие параметры (бэкэнд и время жизни).
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Cacher&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;Slot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;AniObj&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;AniObj&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// Инициализируем слот кеширования. Первый параметр — имя слота, второй — наш объект
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// Получаем данные
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;false&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;===&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$CacheData&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Cacher&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()))&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// Если данные из кеша получить не удалось...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nv&#34;&gt;$CacheData&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;GetFromAnyExternal&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// Получаем данные из внешнего хранилища
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;Cacher&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;addTag&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Cacher&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;newTag&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;AniTagData&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;AniTagDataObj&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// Создаем и сразу же добавляем новый тег к слоту перед сохранением в кеш
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nv&#34;&gt;$tag2&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Cacher&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;newTag&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;AniTagData2&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;AniTagDataObj1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// Создаем новый тег
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;Cacher&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;addTag&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$tag2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// Добавляем новый тег к слоту перед сохранением в кеш
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;Cacher&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;set&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$CacheData&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// Кешируем данные
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// ...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// Если затем нужно сбросить какой-нибудь тег, то нужно будет сделать так:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Cacher&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;newTag&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;AniTagData2&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;AniTagDataObj1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;clear&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// Очищаем кеш тега
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
            </content>    
                                <category scheme="https://valmat.ru/tags/archive" term="archive" label="archive" />
        </entry>
        <entry>
            <title>define vs const в PHP</title>
            <link href="https://valmat.ru/posts/archive/2010/10/define-vs-const-php/" rel="alternate" type="text/html"  hreflang="en" />
            <id>https://valmat.ru/posts/archive/2010/10/define-vs-const-php/</id>
            <published>2010-10-28T19:00:00+00:00</published>
            <updated>2010-10-28T19:00:00+00:00</updated>
            <content type="html">
                &lt;p&gt;Как известно, при разработке крупных веб-приложений помимо архитектуры постоянно приходится задумываться также и о производительности. Этим постом я хотел бы открыть серию публикаций по тестированию PHP на производительность.&lt;/p&gt;
&lt;p&gt;Речь пойдет о сравнении способов хранения констант в приложении на PHP.&lt;br&gt;
А именно сравниваются два подхода:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-php&#34; data-lang=&#34;php&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;define&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;CONST1&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;val11&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;define&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;CONST2&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;val12&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;define&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;CONST2&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;val13&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;и&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-php&#34; data-lang=&#34;php&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;Consts&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;no&#34;&gt;CONST1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;val1&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;no&#34;&gt;CONST2&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;val2&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;no&#34;&gt;CONST3&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;val3&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;В первом случае, вроде бы как должна использоваться специальная область памяти, и такой способ уж если и не экономит память, так точно должен быть быстрее. Второй способ в некоторых случаях существенно удобнее, так как позволяет не захламлять глобальную область видимости.&lt;/p&gt;
&lt;p&gt;В общем, чтобы не гадать, я провел тесты.&lt;/p&gt;
&lt;div class=&#34;flex align-center gblog-post__anchorwrap&#34;&gt;
    &lt;h2 id=&#34;тест-1-инициализация&#34;
    &gt;
        Тест 1. Инициализация
    &lt;/h2&gt;
    &lt;a data-clipboard-text=&#34;https://valmat.ru/posts/archive/2010/10/define-vs-const-php/#тест-1-инициализация&#34; class=&#34;gblog-post__anchor clip flex align-center&#34; aria-label=&#34;Anchor Тест 1. Инициализация&#34; href=&#34;#%d1%82%d0%b5%d1%81%d1%82-1-%d0%b8%d0%bd%d0%b8%d1%86%d0%b8%d0%b0%d0%bb%d0%b8%d0%b7%d0%b0%d1%86%d0%b8%d1%8f&#34;&gt;
        &lt;svg class=&#34;gblog-icon gblog_link&#34;&gt;&lt;use xlink:href=&#34;#gblog_link&#34;&gt;&lt;/use&gt;&lt;/svg&gt;
    &lt;/a&gt;
&lt;/div&gt;
&lt;p&gt;Инициализируем 100 констант при помощи &lt;strong&gt;define&lt;/strong&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-php&#34; data-lang=&#34;php&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;define&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;CACHER_TYPE_1&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;b60861c4492f88589429aab0c67abdd4&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;/*     ...    */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;define&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;CACHER_TYPE_100&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;a66aedeafbc3f1e9fcbaa6a9e8060739&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;memory_start: 114.7578125 Кб&lt;/li&gt;
&lt;li&gt;time: &lt;strong&gt;0.442981719971&lt;/strong&gt; ms&lt;/li&gt;
&lt;li&gt;memory_finish: 120.8515625 Кб&lt;/li&gt;
&lt;li&gt;memory_diff: &lt;strong&gt;6.09375 Кб&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Тестирование через ab:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;$ ab -n 1000 http://test/test/mem_class.php
Requests per second:    714.52 [#/sec] (mean)
Time per request:       **1.400** [ms] (mean)
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Теперь инициализируем через константы класса:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-php&#34; data-lang=&#34;php&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;SlotType&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;no&#34;&gt;TYPE_CACHER_1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;b60861c4492f88589429aab0c67abdd4&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;cm&#34;&gt;/*     ...    */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;no&#34;&gt;TYPE_CACHER_100&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;a66aedeafbc3f1e9fcbaa6a9e8060739&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;memory_start: 114.7578125 Кб&lt;/li&gt;
&lt;li&gt;time: &lt;strong&gt;0.0340938568115&lt;/strong&gt; ms&lt;/li&gt;
&lt;li&gt;memory_finish: 114.9921875 Кб&lt;/li&gt;
&lt;li&gt;memory_diff: &lt;strong&gt;0.234375 Кб&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Тестирование через ab:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;$ ab -n 1000 http://test/test/mem_class.php
Requests per second:    818.27 [#/sec] (mean)
Time per request:       **1.222** [ms] (mean)
&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;flex align-center gblog-post__anchorwrap&#34;&gt;
    &lt;h2 id=&#34;тест-2-чтение&#34;
    &gt;
        Тест 2. Чтение
    &lt;/h2&gt;
    &lt;a data-clipboard-text=&#34;https://valmat.ru/posts/archive/2010/10/define-vs-const-php/#тест-2-чтение&#34; class=&#34;gblog-post__anchor clip flex align-center&#34; aria-label=&#34;Anchor Тест 2. Чтение&#34; href=&#34;#%d1%82%d0%b5%d1%81%d1%82-2-%d1%87%d1%82%d0%b5%d0%bd%d0%b8%d0%b5&#34;&gt;
        &lt;svg class=&#34;gblog-icon gblog_link&#34;&gt;&lt;use xlink:href=&#34;#gblog_link&#34;&gt;&lt;/use&gt;&lt;/svg&gt;
    &lt;/a&gt;
&lt;/div&gt;
&lt;p&gt;Считываем все константы, определённые через &lt;strong&gt;define&lt;/strong&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-php&#34; data-lang=&#34;php&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$var&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;CACHER_TYPE_1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;.&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;CACHER_TYPE_2&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;.&lt;/span&gt; &lt;span class=&#34;cm&#34;&gt;/*...*/&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;.&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;CACHER_TYPE_100&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;time: &lt;strong&gt;0.4&lt;/strong&gt; ms&lt;/li&gt;
&lt;li&gt;memory_diff: &lt;strong&gt;9.3 Кб&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ab -n1000:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Requests per second:    488.63 [#/sec] (mean)
Time per request:       **2.047** [ms] (mean)
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Считываем через константы класса:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-php&#34; data-lang=&#34;php&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$var&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;SlotType&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;TYPE_CACHER_1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;.&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;SlotType&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;TYPE_CACHER_2&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;.&lt;/span&gt; &lt;span class=&#34;cm&#34;&gt;/*...*/&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;.&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;SlotType&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;TYPE_CACHER_100&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;time: &lt;strong&gt;0.12&lt;/strong&gt; ms&lt;/li&gt;
&lt;li&gt;memory_diff: &lt;strong&gt;3.5 Кб&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ab -n1000:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Requests per second:    609.62 [#/sec] (mean)
Time per request:       **1.640** [ms] (mean)
&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;flex align-center gblog-post__anchorwrap&#34;&gt;
    &lt;h2 id=&#34;вывод&#34;
    &gt;
        Вывод
    &lt;/h2&gt;
    &lt;a data-clipboard-text=&#34;https://valmat.ru/posts/archive/2010/10/define-vs-const-php/#вывод&#34; class=&#34;gblog-post__anchor clip flex align-center&#34; aria-label=&#34;Anchor Вывод&#34; href=&#34;#%d0%b2%d1%8b%d0%b2%d0%be%d0%b4&#34;&gt;
        &lt;svg class=&#34;gblog-icon gblog_link&#34;&gt;&lt;use xlink:href=&#34;#gblog_link&#34;&gt;&lt;/use&gt;&lt;/svg&gt;
    &lt;/a&gt;
&lt;/div&gt;
&lt;p&gt;Надо сказать, результат меня несколько удивил. Я ожидал, что по крайней мере скорость обработки с define будет выше. Оказывается, использование варианта&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-php&#34; data-lang=&#34;php&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;Consts&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;no&#34;&gt;CONST1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;val1&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;no&#34;&gt;CONST2&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;val2&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;no&#34;&gt;CONST3&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;val3&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;не только удобнее, но и эффективнее как по скорости исполнения, так и по расходу памяти.&lt;/p&gt;

            </content>    
                                <category scheme="https://valmat.ru/tags/archive" term="archive" label="archive" />
        </entry>
        <entry>
            <title>PHP Counter</title>
            <link href="https://valmat.ru/posts/archive/2010/10/php-counter/" rel="alternate" type="text/html"  hreflang="en" />
            <id>https://valmat.ru/posts/archive/2010/10/php-counter/</id>
            <published>2010-10-28T06:02:00+00:00</published>
            <updated>2010-10-28T06:02:00+00:00</updated>
            <content type="html">
                &lt;p&gt;Выложил на &lt;a
  class=&#34;gblog-markdown__link&#34;
  href=&#34;http://github.com/valmat/MC_Counter&#34;
&gt;github.com&lt;/a&gt; свой класс Counter.&lt;/p&gt;
&lt;p&gt;В основном сделал это, чтобы потестить сам GitHub.&lt;/p&gt;
&lt;p&gt;Адрес страницы на гитхабе: &lt;a
  class=&#34;gblog-markdown__link&#34;
  href=&#34;http://github.com/valmat/MC_Counter&#34;
&gt;http://github.com/valmat/MC_Counter&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;flex align-center gblog-post__anchorwrap&#34;&gt;
    &lt;h2 id=&#34;как-использовать&#34;
    &gt;
        Как использовать
    &lt;/h2&gt;
    &lt;a data-clipboard-text=&#34;https://valmat.ru/posts/archive/2010/10/php-counter/#как-использовать&#34; class=&#34;gblog-post__anchor clip flex align-center&#34; aria-label=&#34;Anchor Как использовать&#34; href=&#34;#%d0%ba%d0%b0%d0%ba-%d0%b8%d1%81%d0%bf%d0%be%d0%bb%d1%8c%d0%b7%d0%be%d0%b2%d0%b0%d1%82%d1%8c&#34;&gt;
        &lt;svg class=&#34;gblog-icon gblog_link&#34;&gt;&lt;use xlink:href=&#34;#gblog_link&#34;&gt;&lt;/use&gt;&lt;/svg&gt;
    &lt;/a&gt;
&lt;/div&gt;
&lt;p&gt;&lt;em&gt;Класс &lt;code&gt;Counter&lt;/code&gt; — это образец реализации счетчика на memcache.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Можно построить другие реализации на общем интерфейсе.&lt;br&gt;
Сохранение результатов применения значений счетчика осуществляется по заданному числу.&lt;br&gt;
Можно реализовать сохранение по заданному интервалу времени.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Конструктор принимает три аргумента: ключ, имя слота и идентификатор для инициализации слота.&lt;/li&gt;
&lt;li&gt;Для чего это сделано: инкремент счетчика должен быть очень быстрой операцией.&lt;/li&gt;
&lt;li&gt;Не целесообразно тратить время и системные ресурсы на создание объектов, которые не будут использованы.&lt;/li&gt;
&lt;li&gt;Поэтому передается только имя класса слота, который создается только в случае необходимости.&lt;/li&gt;
&lt;li&gt;К таким случаям относится обмен данными между локальным и постоянным хранилищем счетчика.&lt;/li&gt;
&lt;li&gt;Слоты необходимы, так как Counter не может знать о способе хранения данных в постоянном хранилище и путях доступа к ним.&lt;/li&gt;
&lt;li&gt;Для предотвращения состояния гонки необходим механизм блокировок.&lt;/li&gt;
&lt;li&gt;При наличии блокировки процессы, не получившие эксклюзивные права на получение данных, будут писать во временное хранилище, а процесс, установивший блокировку, по окончании своей работы инкрементирует счетчик данными из временного хранилища.&lt;/li&gt;
&lt;li&gt;При сбросе данных в постоянное хранилище по условию достижения кратности значения счетчика (&lt;code&gt;$this-&amp;gt;Val % $this-&amp;gt;upd_delim&lt;/code&gt;), блокировка не требуется, так как в этом случае (при достаточно большом значении &lt;code&gt;$this-&amp;gt;upd_delim&lt;/code&gt;) в текущий момент времени только один процесс приходит к необходимости сброса данных.&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;flex align-center gblog-post__anchorwrap&#34;&gt;
    &lt;h3 id=&#34;пример-использования&#34;
    &gt;
        Пример использования
    &lt;/h3&gt;
    &lt;a data-clipboard-text=&#34;https://valmat.ru/posts/archive/2010/10/php-counter/#пример-использования&#34; class=&#34;gblog-post__anchor clip flex align-center&#34; aria-label=&#34;Anchor Пример использования&#34; href=&#34;#%d0%bf%d1%80%d0%b8%d0%bc%d0%b5%d1%80-%d0%b8%d1%81%d0%bf%d0%be%d0%bb%d1%8c%d0%b7%d0%be%d0%b2%d0%b0%d0%bd%d0%b8%d1%8f&#34;&gt;
        &lt;svg class=&#34;gblog-icon gblog_link&#34;&gt;&lt;use xlink:href=&#34;#gblog_link&#34;&gt;&lt;/use&gt;&lt;/svg&gt;
    &lt;/a&gt;
&lt;/div&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-php&#34; data-lang=&#34;php&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$cnt&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Counter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;anykey&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;AnySlot&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;15&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$cnt&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;increment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$cnt&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$cnt&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;set&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;11&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
            </content>    
                                <category scheme="https://valmat.ru/tags/archive" term="archive" label="archive" />
        </entry>
        <entry>
            <title>Восстановление удалённых и повреждённых данных в Linux</title>
            <link href="https://valmat.ru/posts/archive/2010/10/linux-restore/" rel="alternate" type="text/html"  hreflang="en" />
            <id>https://valmat.ru/posts/archive/2010/10/linux-restore/</id>
            <published>2010-10-18T18:04:00+00:00</published>
            <updated>2010-10-18T18:04:00+00:00</updated>
            <content type="html">
                &lt;p&gt;Когда-то давно, лет десять назад, случалось мне отформатировать раздел жёсткого диска под Windows. На диске была важная информация, поэтому встала задача данные восстановить. Помню, путём продолжительного гугления были найдены несколько замечательных программ и кряков к ним. И данные были, хоть и частично, но восстановлены. Назывались эти программы, вроде бы, Easy Recovery, Recover4All и какая-то ещё.&lt;/p&gt;
&lt;p&gt;И вот на днях мне принесли жёсткий диск с разделом, на который была установлена новая Windows поверх старой, и вся нужная владельцу информация была благополучно удалена.&lt;/p&gt;
&lt;p&gt;Поскольку сейчас Windows у меня нет, была найдена чудесная линуксовая утилита под названием &lt;strong&gt;foremost&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;Вот, всё-таки, за что я люблю Linux — это за лаконичность и изящность решений (ну и за логичность архитектуры, конечно).&lt;/p&gt;
&lt;p&gt;Для восстановления данных потребовалась всего одна команда в терминале:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;foremost -t jpg -o ~/bak -i /dev/sdb1
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Теперь по порядку, что к чему:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;#&lt;/code&gt; — запускаем от root, чтобы не было проблем с чтением.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-t&lt;/code&gt; — тип восстанавливаемых файлов. Можно написать &lt;code&gt;-t all&lt;/code&gt;, чтобы восстановить файлы всех типов, либо одно из значений из списка: avi, bmp, dll, doc, exe, gif, htm, jar, jpg, mbd, mov, mpg, pdf, png, ppt, rar, rif, sdw, sx, sxc, sxi, sxw, vis, wav, wmv, xls, zip.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-o ~/bak&lt;/code&gt; — куда складывать результат.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-i /dev/sdb1&lt;/code&gt; — здесь указываем раздел, который нужно сканировать. Поддерживаются разные файловые системы. Тот диск, который приносили мне, был с NTFS.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Если запустить с опцией &lt;code&gt;-t all&lt;/code&gt;, то будут созданы разные каталоги под каждый тип файлов, что само по себе очень удобно.&lt;/p&gt;
&lt;p&gt;Я особо не вглядывался, что он там восстановил, но при беглом обзоре можно было заключить, что в своей массе почти все файлы были восстановлены корректно. Было несколько битых фотографий, но так как раздел был не пустой, его не просто отформатировали, но и успели записать на него новые данные.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;P.S.&lt;/strong&gt; Foremost есть в репозитории Ubuntu.&lt;br&gt;
Т.е. установить можно так:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo apt-get install foremost
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
            </content>    
                                <category scheme="https://valmat.ru/tags/archive" term="archive" label="archive" />
        </entry>
        <entry>
            <title>Принтер Canon LBP 3200 в Ubuntu</title>
            <link href="https://valmat.ru/posts/archive/2010/09/canon-lbp-3200-ubuntu/" rel="alternate" type="text/html"  hreflang="en" />
            <id>https://valmat.ru/posts/archive/2010/09/canon-lbp-3200-ubuntu/</id>
            <published>2010-09-20T16:10:00+00:00</published>
            <updated>2010-09-20T16:10:00+00:00</updated>
            <content type="html">
                &lt;p&gt;К великому моему сожалению, принтер Canon LBP 3200 не заработал в Ubuntu 9.10 &amp;ldquo;из коробки&amp;rdquo;.&lt;/p&gt;
&lt;p&gt;Драйверов для него в стандартной поставке нет. Просто скачать и установить &lt;a
  class=&#34;gblog-markdown__link&#34;
  href=&#34;http://files.canon-europe.com/files/soft31118/software/CAPTDRV180.tar.gz&#34;
&gt;драйвер&lt;/a&gt; тоже сразу не получилось. Поэтому я решил поискать ответ в интернете.&lt;/p&gt;
&lt;p&gt;Мне удалось найти две адекватные ссылки:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a
  class=&#34;gblog-markdown__link&#34;
  href=&#34;http://forum.ubuntu.ru/index.php?topic=87445.0&#34;
&gt;http://forum.ubuntu.ru/index.php?topic=87445.0&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a
  class=&#34;gblog-markdown__link&#34;
  href=&#34;http://help.ubuntu.ru/wiki/%D0%BF%D1%80%D0%B8%D0%BD%D1%82%D0%B5%D1%80%D1%8B_canon_capt&#34;
&gt;http://help.ubuntu.ru/wiki/%D0%BF%D1%80%D0%B8%D0%BD%D1%82%D0%B5%D1%80%D1%8B_canon_capt&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Собственно, моя инструкция полностью написана, руководствуясь этими ссылками. К сожалению, обе они по отдельности результата не дали.&lt;/p&gt;
&lt;p&gt;Все, что написано ниже, у меня дало положительный результат.&lt;/p&gt;
&lt;div class=&#34;flex align-center gblog-post__anchorwrap&#34;&gt;
    &lt;h2 id=&#34;инструкция-для-ubuntu-910&#34;
    &gt;
        Инструкция для Ubuntu 9.10
    &lt;/h2&gt;
    &lt;a data-clipboard-text=&#34;https://valmat.ru/posts/archive/2010/09/canon-lbp-3200-ubuntu/#инструкция-для-ubuntu-910&#34; class=&#34;gblog-post__anchor clip flex align-center&#34; aria-label=&#34;Anchor Инструкция для Ubuntu 9.10&#34; href=&#34;#%d0%b8%d0%bd%d1%81%d1%82%d1%80%d1%83%d0%ba%d1%86%d0%b8%d1%8f-%d0%b4%d0%bb%d1%8f-ubuntu-910&#34;&gt;
        &lt;svg class=&#34;gblog-icon gblog_link&#34;&gt;&lt;use xlink:href=&#34;#gblog_link&#34;&gt;&lt;/use&gt;&lt;/svg&gt;
    &lt;/a&gt;
&lt;/div&gt;
&lt;p&gt;Открываем терминал:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo su
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Удаляем:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;libcupsys2 и libstdc++5:&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/usr/sbin/ccpdadmin -x LBP3200
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo /usr/sbin/lpadmin -x LBP320
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo dpkg -P cndrvcups-capt
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo dpkg -P cndrvcups-common
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Далее скачиваем и устанавливаем &lt;code&gt;libcupsys2&lt;/code&gt; и &lt;code&gt;libstdc++5&lt;/code&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a
  class=&#34;gblog-markdown__link&#34;
  href=&#34;https://launchpad.net/ubuntu/karmic/&amp;#43;package/libcupsys2&#34;
&gt;libcupsys2&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a
  class=&#34;gblog-markdown__link&#34;
  href=&#34;http://packages.ubuntu.com/jaunty/libstdc&amp;#43;&amp;#43;5&#34;
&gt;libstdc++5&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Далее надо скачать драйвер принтера:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo su
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; /tmp
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;wget http://files.canon-europe.com/files/soft31118/software/CAPTDRV180.tar.gz
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tar -xzf CAPTDRV180.tar.gz
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; ./CANON_UK/Driver/Debian
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;dpkg -i cndrvcups-common_1.80-1_i386.deb
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;dpkg -i cndrvcups-capt_1.80-1_i386.deb
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Далее надо отредактировать файл &lt;code&gt;/etc/ccpd.conf&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo gedit /etc/ccpd.conf
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Меняем строки:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;#&amp;lt;Printer  LBP3200&amp;gt;
#DevicePath /dev/usb/lp0
#&amp;lt;/Printer&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;на&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;&amp;lt;Printer  LBP3200&amp;gt;
DevicePath /dev/usblp0
&amp;lt;/Printer&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Перегружаем сервер печати:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo /etc/init.d/cups restart
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo /etc/init.d/ccpd stop &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; sudo /etc/init.d/ccpd start
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Регистрируем принтер в ccpd:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo /usr/sbin/ccpdadmin -p LBP3200 -o /dev/usblp0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo /etc/init.d/ccpd stop &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; sudo /etc/init.d/ccpd start
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Окно статуса принтера можно открыть так:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;captstatusui -P LBP3200
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;div class=&#34;flex align-center gblog-post__anchorwrap&#34;&gt;
    &lt;h2 id=&#34;update&#34;
    &gt;
        UPDATE
    &lt;/h2&gt;
    &lt;a data-clipboard-text=&#34;https://valmat.ru/posts/archive/2010/09/canon-lbp-3200-ubuntu/#update&#34; class=&#34;gblog-post__anchor clip flex align-center&#34; aria-label=&#34;Anchor UPDATE&#34; href=&#34;#update&#34;&gt;
        &lt;svg class=&#34;gblog-icon gblog_link&#34;&gt;&lt;use xlink:href=&#34;#gblog_link&#34;&gt;&lt;/use&gt;&lt;/svg&gt;
    &lt;/a&gt;
&lt;/div&gt;
&lt;p&gt;Поставил Linux Mint 16 64bit (~ Ubuntu 13.10), и в нем моя инструкция, конечно, не подходит.&lt;/p&gt;
&lt;p&gt;Пришлось проходить этот квест заново. К счастью, Canon выпустил новые драйверы, что немного облегчает задачу.&lt;/p&gt;
&lt;p&gt;Итак, имеем названную систему.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Скачиваем и устанавливаем deb-пакеты с &lt;a
  class=&#34;gblog-markdown__link&#34;
  href=&#34;http://www.canon-europe.com/Support/Consumer_Products/products/printers/Laser/Laser_Shot_LBP3200.aspx&#34;
&gt;драйверами от производителя&lt;/a&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Подключаем и включаем принтер. Смотрим, на какой usb-порт он подключился (у меня &lt;code&gt;/dev/usb/lp1&lt;/code&gt;). Смотреть нужно тут: &lt;code&gt;/dev/usb&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Правим &lt;code&gt;/etc/ccpd.conf&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo gedit /etc/ccpd.conf
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Меняем строки:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;#&amp;lt;Printer  LBP3200&amp;gt;
#DevicePath /dev/usb/lp0
#&amp;lt;/Printer&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;на&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;&amp;lt;Printer  LBP3200&amp;gt;
DevicePath /dev/usb/lp1
&amp;lt;/Printer&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Добавляем принтер (в архиве с драйверами есть README, можно посмотреть откуда взялись эти строки и на что их менять, если принтер отличается):&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo /usr/sbin/lpadmin -p LBP3200 -P /usr/share/cups/model/CNCUPSLBP3200CAPTK.ppd -v ccp://localhost:59687 -E
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo /usr/sbin/lpadmin -p LBP3200 -m CNCUPSLBP3200CAPTK.ppd -v ccp://localhost:59787 -E
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo /usr/sbin/ccpdadmin -p LBP3200 -o /dev/usb/lp1
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Перегружаем сервер печати (см. выше)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Печатаем пробную страницу.&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Все!&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;PS&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Что еще обнаружилось:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Нужно добавить &lt;code&gt;/etc/init.d/ccpd&lt;/code&gt; в автозагрузку:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;update-rc.d ccpd defaults 20&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Причем, даже после добавления в автозагрузку, нужно перезагружать ccpd. Поэтому еще нужно в &lt;code&gt;/etc/rc.local&lt;/code&gt; перед &lt;code&gt;exit 0&lt;/code&gt; добавить:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/etc/init.d/ccpd restart
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Кроме того выяснилось, что в зависимости от того, был ли подключен включенный принтер до загрузки системы или нет, принтеру назначаются разные файлы устройства. Если включен после загрузки ОС, то &lt;code&gt;/dev/usb/lp1&lt;/code&gt;, если до — то &lt;code&gt;/dev/usb/lp0&lt;/code&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Чтобы преодолеть эту неприятность, я изобрел следующий костыль:&lt;/p&gt;
&lt;p&gt;В &lt;code&gt;/etc/init.d/ccpd&lt;/code&gt; в начало секций &lt;code&gt;ccpd_start()&lt;/code&gt; и &lt;code&gt;ccpd_stop()&lt;/code&gt; (только &lt;code&gt;ccpd_start&lt;/code&gt; недостаточно) добавил следующий блок:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;###############################&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Fix гуляние портов&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt; -e /dev/usb/lp0 &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;then&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Exist /dev/usb/lp0&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt; ! -e /dev/usb/lp1 &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;then&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;NOT exist /dev/usb/lp1&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;ln -s /dev/usb/lp0 /dev/usb/lp1&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        ln -s /dev/usb/lp0 /dev/usb/lp1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;fi&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;fi&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;###############################&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Этот блок создает символическую ссылку в случаях, когда система загружается с уже включенным принтером.&lt;/p&gt;

            </content>    
                                <category scheme="https://valmat.ru/tags/archive" term="archive" label="archive" />
        </entry>
        <entry>
            <title>Установка LaTeX в Linux Ubuntu</title>
            <link href="https://valmat.ru/posts/archive/2010/09/latex-linux-ubuntu/" rel="alternate" type="text/html"  hreflang="en" />
            <id>https://valmat.ru/posts/archive/2010/09/latex-linux-ubuntu/</id>
            <published>2010-09-08T14:30:00+00:00</published>
            <updated>2010-09-08T14:30:00+00:00</updated>
            <content type="html">
                &lt;p&gt;Как утверждает &lt;a
  class=&#34;gblog-markdown__link&#34;
  href=&#34;http://ru.wikipedia.org/wiki/TeX_Live&#34;
&gt;Википедия&lt;/a&gt;, с 2006-го года пакет teTeX более не поддерживается, а вместо него поддерживается TeX Live. Его и ставим.&lt;/p&gt;
&lt;p&gt;Инструкцию по установке подглядел здесь: &lt;a
  class=&#34;gblog-markdown__link&#34;
  href=&#34;http://linuxandfriends.com/2009/10/06/install-latex-in-ubuntu-linux/&#34;
&gt;http://linuxandfriends.com/2009/10/06/install-latex-in-ubuntu-linux/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Ставим:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo su
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;apt-get install texlive texlive-full texlive-fonts-recommended latex-beamer texlive-pictures texlive-latex-extra
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;texlive-full&lt;/code&gt; попросил достаточно много места на диске (около 700 МБ). Место у меня было, поэтому я его всё же установил, но, при необходимости, можно не устанавливать &lt;code&gt;texlive-full&lt;/code&gt;, а установить только нужные пакеты, которые входят в &lt;code&gt;texlive-full&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;В качестве IDE были на пробу установлены LyX, gedit-latex-plugin и TeXmaker.&lt;br&gt;
Про них пока ничего сказать не могу, т.к. ещё не юзал.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;PS:&lt;/strong&gt; это была моя первая установка LaTeX в Линуксе, до этого я устанавливал &lt;a
  class=&#34;gblog-markdown__link&#34;
  href=&#34;http://ru.wikipedia.org/wiki/MiKTeX&#34;
&gt;MiKTeX&lt;/a&gt; под виндой. Как всегда, небо и земля. Вот уж что действительно танцы с бубном, так это ставить МикТех под винду.&lt;/p&gt;

            </content>    
                                <category scheme="https://valmat.ru/tags/archive" term="archive" label="archive" />
        </entry>
        <entry>
            <title>Рассказ о том, как я жесткий диск на ноуте менял</title>
            <link href="https://valmat.ru/posts/archive/2010/08/laptop-hdd/" rel="alternate" type="text/html"  hreflang="en" />
            <id>https://valmat.ru/posts/archive/2010/08/laptop-hdd/</id>
            <published>2010-08-29T11:16:00-07:00</published>
            <updated>2010-08-29T11:16:00-07:00</updated>
            <content type="html">
                &lt;p&gt;Был у меня, в общем-то, достаточный для работы жесткий диск объемом 250 ГБ, но не жилось мне спокойно, и захотелось мне поставить жесткий диск на 500 ГБ.&lt;/p&gt;
&lt;p&gt;Сказано — сделано. Винт купил и поставил. Надо переносить систему. Переустановка ОС — это не наш путь, разумеется.&lt;/p&gt;
&lt;p&gt;Далее будет описано, что я делал (и что не нужно было делать), а в конце — как всё-таки у меня получилось &lt;del&gt;через одно место&lt;/del&gt;.&lt;/p&gt;
&lt;p&gt;Итак, на моем старом винте было три раздела: &lt;code&gt;ntfs&lt;/code&gt;, &lt;code&gt;ext4&lt;/code&gt; и &lt;code&gt;swap&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Новый жесткий диск я воткнул в ноутбук, а старый подключил по USB через переноску.&lt;/p&gt;
&lt;p&gt;Самое логичное было бы сделать:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;dd &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/dev/sdb &lt;span class=&#34;nv&#34;&gt;of&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/dev/sda &lt;span class=&#34;nv&#34;&gt;bs&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;4096&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;conv&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;sync,noerror
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Но этот способ не сработал. Разделы создались, но файловые системы у них не определились, из-за чего пришлось бы их переформатировать.&lt;/p&gt;
&lt;p&gt;Собственно, того же результата можно было добиться, просто скопировав загрузчик и таблицу разделов:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;dd &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/dev/sdb &lt;span class=&#34;nv&#34;&gt;of&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/dev/sda &lt;span class=&#34;nv&#34;&gt;bs&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;512&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;count&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;После этого я по очереди удалил каждый раздел на новом жестком диске и с помощью gparted перенес их со старого жесткого диска. В результате, конечно же, загрузочный сектор и таблица разделов у меня потерлись.&lt;/p&gt;
&lt;p&gt;Всевозможные попытки восстановить grub, осуществляемые при помощи гугления, результата не дали.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Что в итоге я сделал:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Раздел с ntfs оставил как есть (т.е. полностью клонированным со старого жесткого диска).&lt;/li&gt;
&lt;li&gt;На раздел ext4, на котором у меня стоял Linux, я заново установил дистрибутив. Устанавливать нужно обязательно тот дистрибутив, который стоял до этого, иначе может не получиться.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Таким образом у меня пересоздалась таблица разделов и загрузочный сектор (вообще таблица разделов, конечно, была).&lt;/p&gt;
&lt;p&gt;Затем я полностью стер всё на линуксовом разделе и скопировал при помощи утилиты &lt;strong&gt;rsync&lt;/strong&gt; всё со старого линуксового раздела. Всё это я делал, загрузившись с LiveCD.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;rsync&lt;/code&gt; в отличие от &lt;code&gt;cp&lt;/code&gt; (даже &lt;code&gt;cp -a&lt;/code&gt;) нормально копирует скрытые файлы, т.е. те, которые начинаются с &amp;ldquo;.&amp;rdquo;. Обе команды &lt;code&gt;rsync -a&lt;/code&gt; и &lt;code&gt;cp -a&lt;/code&gt; могут копировать атрибуты файлов и права доступа.&lt;/p&gt;
&lt;p&gt;Выглядит команда так:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;rsync -a /.../.../  /.../.../
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Закрывающий слеш существенен, поскольку без него получится не совсем то, что нужно.&lt;/p&gt;
&lt;p&gt;Чтобы система начала загружаться, нужно ещё в файлах&lt;br&gt;
&lt;strong&gt;/boot/grub/grub.cfg&lt;/strong&gt; и &lt;strong&gt;/etc/fstab&lt;/strong&gt;&lt;br&gt;
поменять uuid разделов на новые.&lt;/p&gt;
&lt;p&gt;Узнать их можно командой:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;blkid
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Ну и напоследок, поскольку у меня появилось теперь много свободного места, я создал 250-гигабайтный раздел и примонтировал его к &lt;code&gt;/home&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Для этого я всё тем же &lt;code&gt;rsync&lt;/code&gt;-ом перенёс все файлы (сидя на LiveCD) на отведённый для этого раздел и прописал в его fstab:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# /home&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/dev/sda4    /home  ext4 defaults,noatime,errors&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;remount-ro &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
            </content>    
                                <category scheme="https://valmat.ru/tags/archive" term="archive" label="archive" />
        </entry>
        <entry>
            <title>Разборка HP ProBook 4710s: доступ к памяти</title>
            <link href="https://valmat.ru/posts/archive/2010/08/hp-probook-4710s/" rel="alternate" type="text/html"  hreflang="en" />
            <id>https://valmat.ru/posts/archive/2010/08/hp-probook-4710s/</id>
            <published>2010-08-17T06:44:00+00:00</published>
            <updated>2010-08-17T06:44:00+00:00</updated>
            <content type="html">
                &lt;p&gt;Решил я обновить свой ноутбук — увеличить память, да выяснилось, что на HP ProBook 4710s доступ к внутренностям организован не так, как у большинства других моделей, а совершенно через другое место. Поэтому выкладываю здесь инструкцию по открытию этого ноутбука.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Шаг 1:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Снимаем аккумулятор и откручиваем 5 болтов под ним:&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;./1.JPG&#34;
  alt=&#34;Снятие аккумулятора и болтов&#34;
  
/&gt;&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;./2.JPG&#34;
  alt=&#34;Болты под аккумулятором&#34;
  
/&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Шаг 2:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Затем откручиваем 2 болта на задней части ноутбука:&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;./3.JPG&#34;
  alt=&#34;Два болта на задней части&#34;
  
/&gt;&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;./4.JPG&#34;
  alt=&#34;Вид после откручивания&#34;
  
/&gt;&lt;/p&gt;
&lt;p&gt;Складываем все шурупы в одном месте, чтобы не потерять:&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;./5.JPG&#34;
  alt=&#34;Складываем шурупы&#34;
  
/&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Шаг 3:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Толчком от себя снимаем заднюю часть верхней панели (ту, на которой динамики):&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;./6.JPG&#34;
  alt=&#34;Снимаем верхнюю панель&#34;
  
/&gt;&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;./7.JPG&#34;
  alt=&#34;Панель снята&#34;
  
/&gt;&lt;/p&gt;
&lt;p&gt;Эту часть можно полностью удалить, чтобы не мешала:&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;./7-1.JPG&#34;
  alt=&#34;Удаляем панель&#34;
  
/&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Шаг 4:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Далее у нас открывается доступ к болтам крепления клавиатуры:&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;./8-1.JPG&#34;
  alt=&#34;Доступ к болтам клавиатуры&#34;
  
/&gt;&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;./8-2.JPG&#34;
  alt=&#34;Болты клавиатуры крупнее&#34;
  
/&gt;&lt;/p&gt;
&lt;p&gt;Их нужно открутить и также толчком от себя (без лишних усилий, это всё же не советская техника — можно и сломать) отделяем клавиатуру:&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;./9.JPG&#34;
  alt=&#34;Снимаем клавиатуру&#34;
  
/&gt;&lt;/p&gt;
&lt;p&gt;Вуаля, у нас появился доступ к оперативной памяти:&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;./10.JPG&#34;
  alt=&#34;Доступ к памяти&#34;
  
/&gt;&lt;/p&gt;
&lt;p&gt;А дальше я не полез.&lt;/p&gt;
&lt;p&gt;Собирается всё, естественно, в обратном порядке.&lt;/p&gt;

            </content>    
                                <category scheme="https://valmat.ru/tags/archive" term="archive" label="archive" />
        </entry>
        <entry>
            <title>tmpfs: Операции с файловой системой в виртуальной памяти</title>
            <link href="https://valmat.ru/posts/archive/2010/07/tmpfs/" rel="alternate" type="text/html"  hreflang="en" />
            <id>https://valmat.ru/posts/archive/2010/07/tmpfs/</id>
            <published>2010-07-24T11:08:00+00:00</published>
            <updated>2010-07-24T11:08:00+00:00</updated>
            <content type="html">
                &lt;div class=&#34;flex align-center gblog-post__anchorwrap&#34;&gt;
    &lt;h1 id=&#34;tmpfs-операции-с-файловой-системой-в-виртуальной-памяти&#34;
    &gt;
        tmpfs: Операции с файловой системой в виртуальной памяти
    &lt;/h1&gt;
    &lt;a data-clipboard-text=&#34;https://valmat.ru/posts/archive/2010/07/tmpfs/#tmpfs-операции-с-файловой-системой-в-виртуальной-памяти&#34; class=&#34;gblog-post__anchor clip flex align-center&#34; aria-label=&#34;Anchor tmpfs: Операции с файловой системой в виртуальной памяти&#34; href=&#34;#tmpfs-%d0%be%d0%bf%d0%b5%d1%80%d0%b0%d1%86%d0%b8%d0%b8-%d1%81-%d1%84%d0%b0%d0%b9%d0%bb%d0%be%d0%b2%d0%be%d0%b9-%d1%81%d0%b8%d1%81%d1%82%d0%b5%d0%bc%d0%be%d0%b9-%d0%b2-%d0%b2%d0%b8%d1%80%d1%82%d1%83%d0%b0%d0%bb%d1%8c%d0%bd%d0%be%d0%b9-%d0%bf%d0%b0%d0%bc%d1%8f%d1%82%d0%b8&#34;&gt;
        &lt;svg class=&#34;gblog-icon gblog_link&#34;&gt;&lt;use xlink:href=&#34;#gblog_link&#34;&gt;&lt;/use&gt;&lt;/svg&gt;
    &lt;/a&gt;
&lt;/div&gt;
&lt;p&gt;Для примонтирования при старте вносим в &lt;code&gt;/etc/fstab&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tmpfs /tmp tmpfs &lt;span class=&#34;nv&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;500M,nr_inodes&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;1m,nosuid &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tmpfs /var/lib/php5 tmpfs &lt;span class=&#34;nv&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;200M,nr_inodes&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;1m,nosuid &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Первая строчка размещает в памяти &lt;code&gt;/tmp&lt;/code&gt;, вторая — папку хранения сессий.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Для создания папки для сессий без рестарта системы нужно выполнить следующую последовательность команд в терминале:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mkdir /tmp/ses
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/etc/init.d/nginx stop
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mv /var/lib/php5/* /tmp/ses
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mount tmpfs /var/lib/php5 -t tmpfs -o &lt;span class=&#34;nv&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;200M,nr_inodes&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;1m,nosuid
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mv /tmp/ses/* /var/lib/php5
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/etc/init.d/nginx start
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;rm -r /tmp/ses
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;Предварительно лучше отредактировать &lt;code&gt;fstab&lt;/code&gt;.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;p&gt;Вот более сложный вариант, когда данные сессий хранятся в &lt;code&gt;/tmp&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mkdir /dev/shm/ses
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/etc/init.d/nginx stop
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/etc/init.d/php5-spawn stop
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/etc/init.d/mysql stop
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mv /tmp/* /dev/shm/ses
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mount tmpfs /tmp -t tmpfs -o &lt;span class=&#34;nv&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;1g,nr_inodes&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;1m,nosuid
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mount tmpfs /var/lib/php5 -t tmpfs -o &lt;span class=&#34;nv&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;200M,nr_inodes&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;1m,nosuid
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mv /dev/shm/ses/* /tmp
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/etc/init.d/mysql start
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/etc/init.d/php5-spawn start
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/etc/init.d/nginx start
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;rm -r /dev/shm/ses
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;du -hsx /tmp
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
            </content>    
                                <category scheme="https://valmat.ru/tags/archive" term="archive" label="archive" />
        </entry>
        <entry>
            <title>Запуск memcache через unix.socket</title>
            <link href="https://valmat.ru/posts/archive/2010/07/memcache-unixsocket/" rel="alternate" type="text/html"  hreflang="en" />
            <id>https://valmat.ru/posts/archive/2010/07/memcache-unixsocket/</id>
            <published>2010-07-24T11:04:00+00:00</published>
            <updated>2010-07-24T11:04:00+00:00</updated>
            <content type="html">
                &lt;div class=&#34;flex align-center gblog-post__anchorwrap&#34;&gt;
    &lt;h2 id=&#34;запуск-memcache-через-unixsocket&#34;
    &gt;
        Запуск memcache через unix.socket
    &lt;/h2&gt;
    &lt;a data-clipboard-text=&#34;https://valmat.ru/posts/archive/2010/07/memcache-unixsocket/#запуск-memcache-через-unixsocket&#34; class=&#34;gblog-post__anchor clip flex align-center&#34; aria-label=&#34;Anchor Запуск memcache через unix.socket&#34; href=&#34;#%d0%b7%d0%b0%d0%bf%d1%83%d1%81%d0%ba-memcache-%d1%87%d0%b5%d1%80%d0%b5%d0%b7-unixsocket&#34;&gt;
        &lt;svg class=&#34;gblog-icon gblog_link&#34;&gt;&lt;use xlink:href=&#34;#gblog_link&#34;&gt;&lt;/use&gt;&lt;/svg&gt;
    &lt;/a&gt;
&lt;/div&gt;
&lt;p&gt;В файл &lt;code&gt;/etc/memcached.conf&lt;/code&gt; добавляем строчки:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;#-s &amp;lt;file&amp;gt;     unix socket path to listen on (disables network support)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-s /tmp/memcached.socket
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;#-a &amp;lt;mask&amp;gt;     access mask for unix socket, in octal (default 0700)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-a &lt;span class=&#34;m&#34;&gt;0777&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Последняя нужна, чтобы пользователь, от которого работает веб-сервер (у меня &lt;code&gt;www-data&lt;/code&gt;), смог прочитать сокет.&lt;/p&gt;
&lt;p&gt;Перезапускаем демон мемкеша:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/etc/init.d/memcached restart
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Подключаемся к Memcache из PHP-скрипта:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-php&#34; data-lang=&#34;php&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$memcache&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Memcache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$memcache&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;connect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;unix:///tmp/memcached.socket&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Теперь memcache не должен уступать по производительности &lt;code&gt;tmpfs&lt;/code&gt; или &lt;code&gt;/dev/shm&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Правда, в этом случае перестают работать сессии в memcached.&lt;/strong&gt;&lt;br&gt;
То есть следующая конструкция работать не будет:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-php&#34; data-lang=&#34;php&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$session_save_path&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;localhost:11211&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$session_save_path&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;localhost:11211,unix:///tmp/memcached.socket:0&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;ini_set&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;session.save_handler&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;memcache&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;ini_set&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;session.save_path&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$session_save_path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Но для сессий лучше всего всё-таки использовать &lt;a
  class=&#34;gblog-markdown__link&#34;
  href=&#34;/posts/archive/2010/07/tmpfs/&#34;
&gt;tmpfs&lt;/a&gt;.&lt;/p&gt;

            </content>    
                                <category scheme="https://valmat.ru/tags/archive" term="archive" label="archive" />
        </entry>
</feed>
